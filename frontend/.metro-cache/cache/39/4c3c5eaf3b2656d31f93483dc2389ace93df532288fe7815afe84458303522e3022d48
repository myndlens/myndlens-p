{"dependencies":[{"name":"../utils/storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":104},"end":{"line":5,"column":64,"index":168}}],"key":"rswhtWQFlk40P6/ZSXiz3NZSC0I=","exportNames":["*"],"imports":1}},{"name":"../config/env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":169},"end":{"line":6,"column":36,"index":205}}],"key":"RGB4LNLgNgEtjcVNHbEAgFn5Y3M=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getOrCreateDeviceId = getOrCreateDeviceId;\n  exports.getStoredToken = getStoredToken;\n  exports.getStoredUserId = getStoredUserId;\n  exports.pairDevice = pairDevice;\n  exports.clearAuth = clearAuth;\n  var _utilsStorage = require(_dependencyMap[0], \"../utils/storage\");\n  var _configEnv = require(_dependencyMap[1], \"../config/env\");\n  /**\n   * WebSocket auth â€” handles pairing + token management.\n   * Uses cross-platform storage wrapper.\n   */\n\n  const TOKEN_KEY = 'myndlens_auth_token';\n  const USER_ID_KEY = 'myndlens_user_id';\n  const DEVICE_ID_KEY = 'myndlens_device_id';\n  function generateDeviceId() {\n    return 'dev_' + Math.random().toString(36).substring(2, 15) + Date.now().toString(36);\n  }\n  async function getOrCreateDeviceId() {\n    let deviceId = await (0, _utilsStorage.getItem)(DEVICE_ID_KEY);\n    if (!deviceId) {\n      deviceId = generateDeviceId();\n      await (0, _utilsStorage.setItem)(DEVICE_ID_KEY, deviceId);\n    }\n    return deviceId;\n  }\n  async function getStoredToken() {\n    return (0, _utilsStorage.getItem)(TOKEN_KEY);\n  }\n  async function getStoredUserId() {\n    return (0, _utilsStorage.getItem)(USER_ID_KEY);\n  }\n  async function pairDevice(userId) {\n    const deviceId = await getOrCreateDeviceId();\n    const response = await fetch(`${_configEnv.ENV.API_URL}/auth/pair`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        user_id: userId,\n        device_id: deviceId,\n        client_version: '1.0.0'\n      })\n    });\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Pairing failed: ${response.status} ${text}`);\n    }\n    const data = await response.json();\n\n    // Store token and user ID\n    await (0, _utilsStorage.setItem)(TOKEN_KEY, data.token);\n    await (0, _utilsStorage.setItem)(USER_ID_KEY, data.user_id);\n    return data;\n  }\n  async function clearAuth() {\n    await (0, _utilsStorage.deleteItem)(TOKEN_KEY);\n    await (0, _utilsStorage.deleteItem)(USER_ID_KEY);\n  }\n});","lineCount":67,"map":[[7,2,16,0,"exports"],[7,9,16,0],[7,10,16,0,"getOrCreateDeviceId"],[7,29,16,0],[7,32,16,0,"getOrCreateDeviceId"],[7,51,16,0],[8,2,25,0,"exports"],[8,9,25,0],[8,10,25,0,"getStoredToken"],[8,24,25,0],[8,27,25,0,"getStoredToken"],[8,41,25,0],[9,2,29,0,"exports"],[9,9,29,0],[9,10,29,0,"getStoredUserId"],[9,25,29,0],[9,28,29,0,"getStoredUserId"],[9,43,29,0],[10,2,40,0,"exports"],[10,9,40,0],[10,10,40,0,"pairDevice"],[10,20,40,0],[10,23,40,0,"pairDevice"],[10,33,40,0],[11,2,67,0,"exports"],[11,9,67,0],[11,10,67,0,"clearAuth"],[11,19,67,0],[11,22,67,0,"clearAuth"],[11,31,67,0],[12,2,5,0],[12,6,5,0,"_utilsStorage"],[12,19,5,0],[12,22,5,0,"require"],[12,29,5,0],[12,30,5,0,"_dependencyMap"],[12,44,5,0],[13,2,6,0],[13,6,6,0,"_configEnv"],[13,16,6,0],[13,19,6,0,"require"],[13,26,6,0],[13,27,6,0,"_dependencyMap"],[13,41,6,0],[14,2,1,0],[15,0,2,0],[16,0,3,0],[17,0,4,0],[19,2,8,0],[19,8,8,6,"TOKEN_KEY"],[19,17,8,15],[19,20,8,18],[19,41,8,39],[20,2,9,0],[20,8,9,6,"USER_ID_KEY"],[20,19,9,17],[20,22,9,20],[20,40,9,38],[21,2,10,0],[21,8,10,6,"DEVICE_ID_KEY"],[21,21,10,19],[21,24,10,22],[21,44,10,42],[22,2,12,0],[22,11,12,9,"generateDeviceId"],[22,27,12,25,"generateDeviceId"],[22,28,12,25],[22,30,12,36],[23,4,13,2],[23,11,13,9],[23,17,13,15],[23,20,13,18,"Math"],[23,24,13,22],[23,25,13,23,"random"],[23,31,13,29],[23,32,13,30],[23,33,13,31],[23,34,13,32,"toString"],[23,42,13,40],[23,43,13,41],[23,45,13,43],[23,46,13,44],[23,47,13,45,"substring"],[23,56,13,54],[23,57,13,55],[23,58,13,56],[23,60,13,58],[23,62,13,60],[23,63,13,61],[23,66,13,64,"Date"],[23,70,13,68],[23,71,13,69,"now"],[23,74,13,72],[23,75,13,73],[23,76,13,74],[23,77,13,75,"toString"],[23,85,13,83],[23,86,13,84],[23,88,13,86],[23,89,13,87],[24,2,14,0],[25,2,16,7],[25,17,16,22,"getOrCreateDeviceId"],[25,36,16,41,"getOrCreateDeviceId"],[25,37,16,41],[25,39,16,61],[26,4,17,2],[26,8,17,6,"deviceId"],[26,16,17,14],[26,19,17,17],[26,25,17,23],[26,29,17,23,"getItem"],[26,42,17,30],[26,43,17,30,"getItem"],[26,50,17,30],[26,52,17,31,"DEVICE_ID_KEY"],[26,65,17,44],[26,66,17,45],[27,4,18,2],[27,8,18,6],[27,9,18,7,"deviceId"],[27,17,18,15],[27,19,18,17],[28,6,19,4,"deviceId"],[28,14,19,12],[28,17,19,15,"generateDeviceId"],[28,33,19,31],[28,34,19,32],[28,35,19,33],[29,6,20,4],[29,12,20,10],[29,16,20,10,"setItem"],[29,29,20,17],[29,30,20,17,"setItem"],[29,37,20,17],[29,39,20,18,"DEVICE_ID_KEY"],[29,52,20,31],[29,54,20,33,"deviceId"],[29,62,20,41],[29,63,20,42],[30,4,21,2],[31,4,22,2],[31,11,22,9,"deviceId"],[31,19,22,17],[32,2,23,0],[33,2,25,7],[33,17,25,22,"getStoredToken"],[33,31,25,36,"getStoredToken"],[33,32,25,36],[33,34,25,63],[34,4,26,2],[34,11,26,9],[34,15,26,9,"getItem"],[34,28,26,16],[34,29,26,16,"getItem"],[34,36,26,16],[34,38,26,17,"TOKEN_KEY"],[34,47,26,26],[34,48,26,27],[35,2,27,0],[36,2,29,7],[36,17,29,22,"getStoredUserId"],[36,32,29,37,"getStoredUserId"],[36,33,29,37],[36,35,29,64],[37,4,30,2],[37,11,30,9],[37,15,30,9,"getItem"],[37,28,30,16],[37,29,30,16,"getItem"],[37,36,30,16],[37,38,30,17,"USER_ID_KEY"],[37,49,30,28],[37,50,30,29],[38,2,31,0],[39,2,40,7],[39,17,40,22,"pairDevice"],[39,27,40,32,"pairDevice"],[39,28,40,33,"userId"],[39,34,40,47],[39,36,40,72],[40,4,41,2],[40,10,41,8,"deviceId"],[40,18,41,16],[40,21,41,19],[40,27,41,25,"getOrCreateDeviceId"],[40,46,41,44],[40,47,41,45],[40,48,41,46],[41,4,43,2],[41,10,43,8,"response"],[41,18,43,16],[41,21,43,19],[41,27,43,25,"fetch"],[41,32,43,30],[41,33,43,31],[41,36,43,34,"ENV"],[41,46,43,37],[41,47,43,37,"ENV"],[41,50,43,37],[41,51,43,38,"API_URL"],[41,58,43,45],[41,70,43,57],[41,72,43,59],[42,6,44,4,"method"],[42,12,44,10],[42,14,44,12],[42,20,44,18],[43,6,45,4,"headers"],[43,13,45,11],[43,15,45,13],[44,8,45,15],[44,22,45,29],[44,24,45,31],[45,6,45,50],[45,7,45,51],[46,6,46,4,"body"],[46,10,46,8],[46,12,46,10,"JSON"],[46,16,46,14],[46,17,46,15,"stringify"],[46,26,46,24],[46,27,46,25],[47,8,47,6,"user_id"],[47,15,47,13],[47,17,47,15,"userId"],[47,23,47,21],[48,8,48,6,"device_id"],[48,17,48,15],[48,19,48,17,"deviceId"],[48,27,48,25],[49,8,49,6,"client_version"],[49,22,49,20],[49,24,49,22],[50,6,50,4],[50,7,50,5],[51,4,51,2],[51,5,51,3],[51,6,51,4],[52,4,53,2],[52,8,53,6],[52,9,53,7,"response"],[52,17,53,15],[52,18,53,16,"ok"],[52,20,53,18],[52,22,53,20],[53,6,54,4],[53,12,54,10,"text"],[53,16,54,14],[53,19,54,17],[53,25,54,23,"response"],[53,33,54,31],[53,34,54,32,"text"],[53,38,54,36],[53,39,54,37],[53,40,54,38],[54,6,55,4],[54,12,55,10],[54,16,55,14,"Error"],[54,21,55,19],[54,22,55,20],[54,41,55,39,"response"],[54,49,55,47],[54,50,55,48,"status"],[54,56,55,54],[54,60,55,58,"text"],[54,64,55,62],[54,66,55,64],[54,67,55,65],[55,4,56,2],[56,4,58,2],[56,10,58,8,"data"],[56,14,58,26],[56,17,58,29],[56,23,58,35,"response"],[56,31,58,43],[56,32,58,44,"json"],[56,36,58,48],[56,37,58,49],[56,38,58,50],[58,4,60,2],[59,4,61,2],[59,10,61,8],[59,14,61,8,"setItem"],[59,27,61,15],[59,28,61,15,"setItem"],[59,35,61,15],[59,37,61,16,"TOKEN_KEY"],[59,46,61,25],[59,48,61,27,"data"],[59,52,61,31],[59,53,61,32,"token"],[59,58,61,37],[59,59,61,38],[60,4,62,2],[60,10,62,8],[60,14,62,8,"setItem"],[60,27,62,15],[60,28,62,15,"setItem"],[60,35,62,15],[60,37,62,16,"USER_ID_KEY"],[60,48,62,27],[60,50,62,29,"data"],[60,54,62,33],[60,55,62,34,"user_id"],[60,62,62,41],[60,63,62,42],[61,4,64,2],[61,11,64,9,"data"],[61,15,64,13],[62,2,65,0],[63,2,67,7],[63,17,67,22,"clearAuth"],[63,26,67,31,"clearAuth"],[63,27,67,31],[63,29,67,49],[64,4,68,2],[64,10,68,8],[64,14,68,8,"deleteItem"],[64,27,68,18],[64,28,68,18,"deleteItem"],[64,38,68,18],[64,40,68,19,"TOKEN_KEY"],[64,49,68,28],[64,50,68,29],[65,4,69,2],[65,10,69,8],[65,14,69,8,"deleteItem"],[65,27,69,18],[65,28,69,18,"deleteItem"],[65,38,69,18],[65,40,69,19,"USER_ID_KEY"],[65,51,69,30],[65,52,69,31],[66,2,70,0],[67,0,70,1],[67,3]],"functionMap":{"names":["<global>","generateDeviceId","getOrCreateDeviceId","getStoredToken","getStoredUserId","pairDevice","clearAuth"],"mappings":"AAA;ACW;CDE;OEE;CFO;OGE;CHE;OIE;CJE;OKS;CLyB;OME;CNG"},"hasCjsExports":false},"type":"js/module"}]}