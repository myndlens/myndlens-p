{"dependencies":[{"name":"onnxruntime-react-native","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":25,"column":33,"index":930},"end":{"line":25,"column":68,"index":965}}],"key":"rSjxWXojLCSoWWErhNPkFDStHNU=","exportNames":["*"],"imports":1,"isOptional":true}},{"name":"expo-file-system","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":26,"column":27,"index":994},"end":{"line":26,"column":54,"index":1021}}],"key":"uB2MW2OTLfs93DXcpjSoofLkQYE=","exportNames":["*"],"imports":1,"isOptional":true}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.initONNX = initONNX;\n  exports.generatePersonaSummary = generatePersonaSummary;\n  exports.getPKGStats = getPKGStats;\n  /**\n   * On-Device ONNX AI for Digital Self.\n   *\n   * Uses onnxruntime-react-native + BAAI/bge-small-en-v1.5 for semantic embedding.\n   * The ONNX session is prepared for future semantic clustering/search within the PKG.\n   * Current summary generation is template-based (works without ONNX).\n   *\n   * Requires APK rebuild with onnxruntime-react-native installed.\n   * Model is NOT downloaded until initONNX() is explicitly called.\n   */\n\n  const MODEL_URL = 'https://huggingface.co/Xenova/bge-small-en-v1.5/resolve/main/onnx/model_quantized.onnx';\n  const MODEL_CACHE_KEY = 'myndlens_onnx_bge_small_v1';\n  let _initialized = false;\n\n  // ── ONNX Session Management ─────────────────────────────────────────────────\n\n  async function initONNX() {\n    if (_initialized) return true;\n    try {\n      // Dynamically import — graceful if onnxruntime-react-native not installed\n      const {\n        InferenceSession\n      } = require(_dependencyMap[0], \"onnxruntime-react-native\");\n      const {\n        FileSystem\n      } = require(_dependencyMap[1], \"expo-file-system\");\n      const modelPath = `${FileSystem.documentDirectory}${MODEL_CACHE_KEY}.onnx`;\n      const info = await FileSystem.getInfoAsync(modelPath);\n      if (!info.exists) {\n        console.log('[ONNX] Downloading model...');\n        await FileSystem.downloadAsync(MODEL_URL, modelPath);\n        console.log('[ONNX] Model downloaded:', modelPath);\n      }\n      const session = await InferenceSession.create(modelPath, {\n        executionProviders: ['cpu']\n      });\n      // Session stored for future semantic inference — not yet used in summary generation\n      _initialized = session != null;\n      console.log('[ONNX] Session ready');\n      return true;\n    } catch (err) {\n      console.log('[ONNX] Not available (APK rebuild required):', err);\n      return false;\n    }\n  }\n\n  // ── Persona Summary ─────────────────────────────────────────────────────────\n\n  async function generatePersonaSummary(pkg) {\n    const nodes = Object.values(pkg.nodes);\n    if (nodes.length === 0) return 'Your Digital Self is empty. Complete onboarding to build your profile.';\n\n    // Template-based summary built from PKG (works without ONNX)\n    const parts = [];\n    const user = nodes.find(n => n.type === 'User');\n    if (user) parts.push(`**${user.label}**`);\n    const people = nodes.filter(n => n.type === 'Person');\n    if (people.length > 0) {\n      const names = people.slice(0, 5).map(p => {\n        const rel = p.data.relationship ? ` (${p.data.relationship})` : '';\n        return `${p.label}${rel}`;\n      });\n      parts.push(`Inner circle: ${names.join(', ')}${people.length > 5 ? ` +${people.length - 5} more` : ''}`);\n    }\n    const places = nodes.filter(n => n.type === 'Place');\n    if (places.length > 0) {\n      parts.push(`Locations: ${places.map(p => p.label).join(', ')}`);\n    }\n    const traits = nodes.filter(n => n.type === 'Trait');\n    if (traits.length > 0) {\n      parts.push(`Traits: ${traits.map(t => t.label).join(', ')}`);\n    }\n    const interests = nodes.filter(n => n.type === 'Interest');\n    if (interests.length > 0) {\n      parts.push(`Interests: ${interests.map(i => i.label).join(', ')}`);\n    }\n    const events = nodes.filter(n => n.type === 'Event');\n    if (events.length > 0) {\n      parts.push(`${events.length} calendar events indexed`);\n    }\n    return parts.join('\\n');\n  }\n\n  // ── PKG Statistics ───────────────────────────────────────────────────────────\n\n  function getPKGStats(pkg) {\n    const nodes = Object.values(pkg.nodes);\n    return {\n      total: nodes.length,\n      people: nodes.filter(n => n.type === 'Person').length,\n      places: nodes.filter(n => n.type === 'Place').length,\n      traits: nodes.filter(n => n.type === 'Trait').length,\n      interests: nodes.filter(n => n.type === 'Interest').length,\n      events: nodes.filter(n => n.type === 'Event').length,\n      edges: Object.keys(pkg.edges).length\n    };\n  }\n});","lineCount":108,"map":[[7,2,21,0,"exports"],[7,9,21,0],[7,10,21,0,"initONNX"],[7,18,21,0],[7,21,21,0,"initONNX"],[7,29,21,0],[8,2,52,0,"exports"],[8,9,52,0],[8,10,52,0,"generatePersonaSummary"],[8,32,52,0],[8,35,52,0,"generatePersonaSummary"],[8,57,52,0],[9,2,96,0,"exports"],[9,9,96,0],[9,10,96,0,"getPKGStats"],[9,21,96,0],[9,24,96,0,"getPKGStats"],[9,35,96,0],[10,2,1,0],[11,0,2,0],[12,0,3,0],[13,0,4,0],[14,0,5,0],[15,0,6,0],[16,0,7,0],[17,0,8,0],[18,0,9,0],[19,0,10,0],[21,2,14,0],[21,8,14,6,"MODEL_URL"],[21,17,14,15],[21,20,14,18],[21,108,14,106],[22,2,15,0],[22,8,15,6,"MODEL_CACHE_KEY"],[22,23,15,21],[22,26,15,24],[22,54,15,52],[23,2,17,0],[23,6,17,4,"_initialized"],[23,18,17,16],[23,21,17,19],[23,26,17,24],[25,2,19,0],[27,2,21,7],[27,17,21,22,"initONNX"],[27,25,21,30,"initONNX"],[27,26,21,30],[27,28,21,51],[28,4,22,2],[28,8,22,6,"_initialized"],[28,20,22,18],[28,22,22,20],[28,29,22,27],[28,33,22,31],[29,4,23,2],[29,8,23,6],[30,6,24,4],[31,6,25,4],[31,12,25,10],[32,8,25,12,"InferenceSession"],[33,6,25,29],[33,7,25,30],[33,10,25,33,"require"],[33,17,25,40],[33,18,25,40,"_dependencyMap"],[33,32,25,40],[33,63,25,67],[33,64,25,68],[34,6,26,4],[34,12,26,10],[35,8,26,12,"FileSystem"],[36,6,26,23],[36,7,26,24],[36,10,26,27,"require"],[36,17,26,34],[36,18,26,34,"_dependencyMap"],[36,32,26,34],[36,55,26,53],[36,56,26,54],[37,6,28,4],[37,12,28,10,"modelPath"],[37,21,28,19],[37,24,28,22],[37,27,28,25,"FileSystem"],[37,37,28,35],[37,38,28,36,"documentDirectory"],[37,55,28,53],[37,58,28,56,"MODEL_CACHE_KEY"],[37,73,28,71],[37,80,28,78],[38,6,29,4],[38,12,29,10,"info"],[38,16,29,14],[38,19,29,17],[38,25,29,23,"FileSystem"],[38,35,29,33],[38,36,29,34,"getInfoAsync"],[38,48,29,46],[38,49,29,47,"modelPath"],[38,58,29,56],[38,59,29,57],[39,6,31,4],[39,10,31,8],[39,11,31,9,"info"],[39,15,31,13],[39,16,31,14,"exists"],[39,22,31,20],[39,24,31,22],[40,8,32,6,"console"],[40,15,32,13],[40,16,32,14,"log"],[40,19,32,17],[40,20,32,18],[40,49,32,47],[40,50,32,48],[41,8,33,6],[41,14,33,12,"FileSystem"],[41,24,33,22],[41,25,33,23,"downloadAsync"],[41,38,33,36],[41,39,33,37,"MODEL_URL"],[41,48,33,46],[41,50,33,48,"modelPath"],[41,59,33,57],[41,60,33,58],[42,8,34,6,"console"],[42,15,34,13],[42,16,34,14,"log"],[42,19,34,17],[42,20,34,18],[42,46,34,44],[42,48,34,46,"modelPath"],[42,57,34,55],[42,58,34,56],[43,6,35,4],[44,6,37,4],[44,12,37,10,"session"],[44,19,37,17],[44,22,37,20],[44,28,37,26,"InferenceSession"],[44,44,37,42],[44,45,37,43,"create"],[44,51,37,49],[44,52,37,50,"modelPath"],[44,61,37,59],[44,63,37,61],[45,8,38,6,"executionProviders"],[45,26,38,24],[45,28,38,26],[45,29,38,27],[45,34,38,32],[46,6,39,4],[46,7,39,5],[46,8,39,6],[47,6,40,4],[48,6,41,4,"_initialized"],[48,18,41,16],[48,21,41,19,"session"],[48,28,41,26],[48,32,41,30],[48,36,41,34],[49,6,42,4,"console"],[49,13,42,11],[49,14,42,12,"log"],[49,17,42,15],[49,18,42,16],[49,40,42,38],[49,41,42,39],[50,6,43,4],[50,13,43,11],[50,17,43,15],[51,4,44,2],[51,5,44,3],[51,6,44,4],[51,13,44,11,"err"],[51,16,44,14],[51,18,44,16],[52,6,45,4,"console"],[52,13,45,11],[52,14,45,12,"log"],[52,17,45,15],[52,18,45,16],[52,64,45,62],[52,66,45,64,"err"],[52,69,45,67],[52,70,45,68],[53,6,46,4],[53,13,46,11],[53,18,46,16],[54,4,47,2],[55,2,48,0],[57,2,50,0],[59,2,52,7],[59,17,52,22,"generatePersonaSummary"],[59,39,52,44,"generatePersonaSummary"],[59,40,52,45,"pkg"],[59,43,52,53],[59,45,52,72],[60,4,53,2],[60,10,53,8,"nodes"],[60,15,53,13],[60,18,53,16,"Object"],[60,24,53,22],[60,25,53,23,"values"],[60,31,53,29],[60,32,53,30,"pkg"],[60,35,53,33],[60,36,53,34,"nodes"],[60,41,53,39],[60,42,53,40],[61,4,54,2],[61,8,54,6,"nodes"],[61,13,54,11],[61,14,54,12,"length"],[61,20,54,18],[61,25,54,23],[61,26,54,24],[61,28,54,26],[61,35,54,33],[61,107,54,105],[63,4,56,2],[64,4,57,2],[64,10,57,8,"parts"],[64,15,57,23],[64,18,57,26],[64,20,57,28],[65,4,59,2],[65,10,59,8,"user"],[65,14,59,12],[65,17,59,15,"nodes"],[65,22,59,20],[65,23,59,21,"find"],[65,27,59,25],[65,28,59,26,"n"],[65,29,59,27],[65,33,59,31,"n"],[65,34,59,32],[65,35,59,33,"type"],[65,39,59,37],[65,44,59,42],[65,50,59,48],[65,51,59,49],[66,4,60,2],[66,8,60,6,"user"],[66,12,60,10],[66,14,60,12,"parts"],[66,19,60,17],[66,20,60,18,"push"],[66,24,60,22],[66,25,60,23],[66,30,60,28,"user"],[66,34,60,32],[66,35,60,33,"label"],[66,40,60,38],[66,44,60,42],[66,45,60,43],[67,4,62,2],[67,10,62,8,"people"],[67,16,62,14],[67,19,62,17,"nodes"],[67,24,62,22],[67,25,62,23,"filter"],[67,31,62,29],[67,32,62,30,"n"],[67,33,62,31],[67,37,62,35,"n"],[67,38,62,36],[67,39,62,37,"type"],[67,43,62,41],[67,48,62,46],[67,56,62,54],[67,57,62,55],[68,4,63,2],[68,8,63,6,"people"],[68,14,63,12],[68,15,63,13,"length"],[68,21,63,19],[68,24,63,22],[68,25,63,23],[68,27,63,25],[69,6,64,4],[69,12,64,10,"names"],[69,17,64,15],[69,20,64,18,"people"],[69,26,64,24],[69,27,64,25,"slice"],[69,32,64,30],[69,33,64,31],[69,34,64,32],[69,36,64,34],[69,37,64,35],[69,38,64,36],[69,39,64,37,"map"],[69,42,64,40],[69,43,64,41,"p"],[69,44,64,42],[69,48,64,46],[70,8,65,6],[70,14,65,12,"rel"],[70,17,65,15],[70,20,65,18,"p"],[70,21,65,19],[70,22,65,20,"data"],[70,26,65,24],[70,27,65,25,"relationship"],[70,39,65,37],[70,42,65,40],[70,47,65,45,"p"],[70,48,65,46],[70,49,65,47,"data"],[70,53,65,51],[70,54,65,52,"relationship"],[70,66,65,64],[70,69,65,67],[70,72,65,70],[70,74,65,72],[71,8,66,6],[71,15,66,13],[71,18,66,16,"p"],[71,19,66,17],[71,20,66,18,"label"],[71,25,66,23],[71,28,66,26,"rel"],[71,31,66,29],[71,33,66,31],[72,6,67,4],[72,7,67,5],[72,8,67,6],[73,6,68,4,"parts"],[73,11,68,9],[73,12,68,10,"push"],[73,16,68,14],[73,17,68,15],[73,34,68,32,"names"],[73,39,68,37],[73,40,68,38,"join"],[73,44,68,42],[73,45,68,43],[73,49,68,47],[73,50,68,48],[73,53,68,51,"people"],[73,59,68,57],[73,60,68,58,"length"],[73,66,68,64],[73,69,68,67],[73,70,68,68],[73,73,68,71],[73,78,68,76,"people"],[73,84,68,82],[73,85,68,83,"length"],[73,91,68,89],[73,94,68,92],[73,95,68,93],[73,102,68,100],[73,105,68,103],[73,107,68,105],[73,109,68,107],[73,110,68,108],[74,4,69,2],[75,4,71,2],[75,10,71,8,"places"],[75,16,71,14],[75,19,71,17,"nodes"],[75,24,71,22],[75,25,71,23,"filter"],[75,31,71,29],[75,32,71,30,"n"],[75,33,71,31],[75,37,71,35,"n"],[75,38,71,36],[75,39,71,37,"type"],[75,43,71,41],[75,48,71,46],[75,55,71,53],[75,56,71,54],[76,4,72,2],[76,8,72,6,"places"],[76,14,72,12],[76,15,72,13,"length"],[76,21,72,19],[76,24,72,22],[76,25,72,23],[76,27,72,25],[77,6,73,4,"parts"],[77,11,73,9],[77,12,73,10,"push"],[77,16,73,14],[77,17,73,15],[77,31,73,29,"places"],[77,37,73,35],[77,38,73,36,"map"],[77,41,73,39],[77,42,73,40,"p"],[77,43,73,41],[77,47,73,45,"p"],[77,48,73,46],[77,49,73,47,"label"],[77,54,73,52],[77,55,73,53],[77,56,73,54,"join"],[77,60,73,58],[77,61,73,59],[77,65,73,63],[77,66,73,64],[77,68,73,66],[77,69,73,67],[78,4,74,2],[79,4,76,2],[79,10,76,8,"traits"],[79,16,76,14],[79,19,76,17,"nodes"],[79,24,76,22],[79,25,76,23,"filter"],[79,31,76,29],[79,32,76,30,"n"],[79,33,76,31],[79,37,76,35,"n"],[79,38,76,36],[79,39,76,37,"type"],[79,43,76,41],[79,48,76,46],[79,55,76,53],[79,56,76,54],[80,4,77,2],[80,8,77,6,"traits"],[80,14,77,12],[80,15,77,13,"length"],[80,21,77,19],[80,24,77,22],[80,25,77,23],[80,27,77,25],[81,6,78,4,"parts"],[81,11,78,9],[81,12,78,10,"push"],[81,16,78,14],[81,17,78,15],[81,28,78,26,"traits"],[81,34,78,32],[81,35,78,33,"map"],[81,38,78,36],[81,39,78,37,"t"],[81,40,78,38],[81,44,78,42,"t"],[81,45,78,43],[81,46,78,44,"label"],[81,51,78,49],[81,52,78,50],[81,53,78,51,"join"],[81,57,78,55],[81,58,78,56],[81,62,78,60],[81,63,78,61],[81,65,78,63],[81,66,78,64],[82,4,79,2],[83,4,81,2],[83,10,81,8,"interests"],[83,19,81,17],[83,22,81,20,"nodes"],[83,27,81,25],[83,28,81,26,"filter"],[83,34,81,32],[83,35,81,33,"n"],[83,36,81,34],[83,40,81,38,"n"],[83,41,81,39],[83,42,81,40,"type"],[83,46,81,44],[83,51,81,49],[83,61,81,59],[83,62,81,60],[84,4,82,2],[84,8,82,6,"interests"],[84,17,82,15],[84,18,82,16,"length"],[84,24,82,22],[84,27,82,25],[84,28,82,26],[84,30,82,28],[85,6,83,4,"parts"],[85,11,83,9],[85,12,83,10,"push"],[85,16,83,14],[85,17,83,15],[85,31,83,29,"interests"],[85,40,83,38],[85,41,83,39,"map"],[85,44,83,42],[85,45,83,43,"i"],[85,46,83,44],[85,50,83,48,"i"],[85,51,83,49],[85,52,83,50,"label"],[85,57,83,55],[85,58,83,56],[85,59,83,57,"join"],[85,63,83,61],[85,64,83,62],[85,68,83,66],[85,69,83,67],[85,71,83,69],[85,72,83,70],[86,4,84,2],[87,4,86,2],[87,10,86,8,"events"],[87,16,86,14],[87,19,86,17,"nodes"],[87,24,86,22],[87,25,86,23,"filter"],[87,31,86,29],[87,32,86,30,"n"],[87,33,86,31],[87,37,86,35,"n"],[87,38,86,36],[87,39,86,37,"type"],[87,43,86,41],[87,48,86,46],[87,55,86,53],[87,56,86,54],[88,4,87,2],[88,8,87,6,"events"],[88,14,87,12],[88,15,87,13,"length"],[88,21,87,19],[88,24,87,22],[88,25,87,23],[88,27,87,25],[89,6,88,4,"parts"],[89,11,88,9],[89,12,88,10,"push"],[89,16,88,14],[89,17,88,15],[89,20,88,18,"events"],[89,26,88,24],[89,27,88,25,"length"],[89,33,88,31],[89,59,88,57],[89,60,88,58],[90,4,89,2],[91,4,91,2],[91,11,91,9,"parts"],[91,16,91,14],[91,17,91,15,"join"],[91,21,91,19],[91,22,91,20],[91,26,91,24],[91,27,91,25],[92,2,92,0],[94,2,94,0],[96,2,96,7],[96,11,96,16,"getPKGStats"],[96,22,96,27,"getPKGStats"],[96,23,96,28,"pkg"],[96,26,96,36],[96,28,104,2],[97,4,105,2],[97,10,105,8,"nodes"],[97,15,105,13],[97,18,105,16,"Object"],[97,24,105,22],[97,25,105,23,"values"],[97,31,105,29],[97,32,105,30,"pkg"],[97,35,105,33],[97,36,105,34,"nodes"],[97,41,105,39],[97,42,105,40],[98,4,106,2],[98,11,106,9],[99,6,107,4,"total"],[99,11,107,9],[99,13,107,11,"nodes"],[99,18,107,16],[99,19,107,17,"length"],[99,25,107,23],[100,6,108,4,"people"],[100,12,108,10],[100,14,108,12,"nodes"],[100,19,108,17],[100,20,108,18,"filter"],[100,26,108,24],[100,27,108,25,"n"],[100,28,108,26],[100,32,108,30,"n"],[100,33,108,31],[100,34,108,32,"type"],[100,38,108,36],[100,43,108,41],[100,51,108,49],[100,52,108,50],[100,53,108,51,"length"],[100,59,108,57],[101,6,109,4,"places"],[101,12,109,10],[101,14,109,12,"nodes"],[101,19,109,17],[101,20,109,18,"filter"],[101,26,109,24],[101,27,109,25,"n"],[101,28,109,26],[101,32,109,30,"n"],[101,33,109,31],[101,34,109,32,"type"],[101,38,109,36],[101,43,109,41],[101,50,109,48],[101,51,109,49],[101,52,109,50,"length"],[101,58,109,56],[102,6,110,4,"traits"],[102,12,110,10],[102,14,110,12,"nodes"],[102,19,110,17],[102,20,110,18,"filter"],[102,26,110,24],[102,27,110,25,"n"],[102,28,110,26],[102,32,110,30,"n"],[102,33,110,31],[102,34,110,32,"type"],[102,38,110,36],[102,43,110,41],[102,50,110,48],[102,51,110,49],[102,52,110,50,"length"],[102,58,110,56],[103,6,111,4,"interests"],[103,15,111,13],[103,17,111,15,"nodes"],[103,22,111,20],[103,23,111,21,"filter"],[103,29,111,27],[103,30,111,28,"n"],[103,31,111,29],[103,35,111,33,"n"],[103,36,111,34],[103,37,111,35,"type"],[103,41,111,39],[103,46,111,44],[103,56,111,54],[103,57,111,55],[103,58,111,56,"length"],[103,64,111,62],[104,6,112,4,"events"],[104,12,112,10],[104,14,112,12,"nodes"],[104,19,112,17],[104,20,112,18,"filter"],[104,26,112,24],[104,27,112,25,"n"],[104,28,112,26],[104,32,112,30,"n"],[104,33,112,31],[104,34,112,32,"type"],[104,38,112,36],[104,43,112,41],[104,50,112,48],[104,51,112,49],[104,52,112,50,"length"],[104,58,112,56],[105,6,113,4,"edges"],[105,11,113,9],[105,13,113,11,"Object"],[105,19,113,17],[105,20,113,18,"keys"],[105,24,113,22],[105,25,113,23,"pkg"],[105,28,113,26],[105,29,113,27,"edges"],[105,34,113,32],[105,35,113,33],[105,36,113,34,"length"],[106,4,114,2],[106,5,114,3],[107,2,115,0],[108,0,115,1],[108,3]],"functionMap":{"names":["<global>","initONNX","generatePersonaSummary","nodes.find$argument_0","nodes.filter$argument_0","people.slice.map$argument_0","places.map$argument_0","traits.map$argument_0","interests.map$argument_0","getPKGStats"],"mappings":"AAA;OCoB;CD2B;OEI;0BCO,sBD;8BEG,wBF;yCGE;KHG;8BEI,uBF;wCIE,YJ;8BEG,uBF;qCKE,YL;iCEG,0BF;2CME,YN;8BEG,uBF;CFM;OSI;yBLY,wBK;yBLC,uBK;yBLC,uBK;4BLC,0BK;yBLC,uBK;CTG"},"hasCjsExports":false},"type":"js/module"}]}