{"dependencies":[{"name":"./pkg","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":419},"end":{"line":12,"column":50,"index":469}}],"key":"+AXKDS3Rpfle7eEXX3r5kv/MKi0=","exportNames":["*"],"imports":1}},{"name":"../onboarding/smart-processing","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":470},"end":{"line":13,"column":97,"index":567}}],"key":"ZNCeTy7P+J/yHFMZinII4PU/c2U=","exportNames":["*"],"imports":1}},{"name":"expo-contacts","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":22,"column":21,"index":840},"end":{"line":22,"column":45,"index":864}}],"key":"pU46eOxB0NIFxgKjxZlZqyfeBQg=","exportNames":["*"],"imports":1,"isOptional":true}},{"name":"expo-calendar","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":73,"column":21,"index":2170},"end":{"line":73,"column":45,"index":2194}}],"key":"OirB2FXDQdA2aAxXZD9+/NVuM+c=","exportNames":["*"],"imports":1,"isOptional":true}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.ingestContacts = ingestContacts;\n  exports.ingestCalendar = ingestCalendar;\n  exports.runTier1Ingestion = runTier1Ingestion;\n  var _pkg = require(_dependencyMap[0], \"./pkg\");\n  var _onboardingSmartProcessing = require(_dependencyMap[1], \"../onboarding/smart-processing\");\n  /**\n   * Device Signal Ingester — Tier 1 passive learning.\n   *\n   * Reads contacts + calendar from the device and populates the local PKG.\n   * Uses existing JS heuristics from smart-processing.ts.\n   * Requires expo-contacts + expo-calendar (added in next APK build).\n   *\n   * Current: works when permissions are granted and libraries are available.\n   * Falls back gracefully if permissions denied or libraries not installed.\n   */\n\n  /**\n   * Import contacts from device into local PKG.\n   * Requires expo-contacts permission.\n   */\n  async function ingestContacts(userId) {\n    try {\n      // Dynamically import expo-contacts (graceful fallback if not installed)\n      const Contacts = require(_dependencyMap[2], \"expo-contacts\");\n      const {\n        status\n      } = await Contacts.requestPermissionsAsync();\n      if (status !== 'granted') {\n        console.log('[Ingester] Contacts permission denied');\n        return 0;\n      }\n      const {\n        data\n      } = await Contacts.getContactsAsync({\n        fields: [Contacts.Fields.Name, Contacts.Fields.Emails, Contacts.Fields.PhoneNumbers, Contacts.Fields.Company, Contacts.Fields.JobTitle]\n      });\n\n      // Score and filter using existing heuristics\n      const scored = (0, _onboardingSmartProcessing.scoreAndFilterContacts)(data, 50);\n      let count = 0;\n      for (const contact of scored) {\n        await (0, _pkg.registerPerson)(userId, contact.name, {\n          email: contact.email,\n          phone: contact.phone,\n          role: contact.role,\n          relationship: contact.relationship,\n          company: contact.company\n        }, 'CONTACTS');\n        count++;\n      }\n      console.log(`[Ingester] Imported ${count} contacts into PKG`);\n      return count;\n    } catch (err) {\n      console.log('[Ingester] Contacts ingestion unavailable:', err);\n      return 0;\n    }\n  }\n\n  /**\n   * Import calendar patterns from device into local PKG.\n   * Requires expo-calendar permission.\n   */\n  async function ingestCalendar(userId) {\n    try {\n      const Calendar = require(_dependencyMap[3], \"expo-calendar\");\n      const {\n        status\n      } = await Calendar.requestCalendarPermissionsAsync();\n      if (status !== 'granted') {\n        console.log('[Ingester] Calendar permission denied');\n        return 0;\n      }\n\n      // Get events from last 30 days\n      const end = new Date();\n      const start = new Date(end.getTime() - 30 * 24 * 60 * 60 * 1000);\n      const calendars = await Calendar.getCalendarsAsync(Calendar.EntityTypes.EVENT);\n      const calendarIds = calendars.map(c => c.id);\n\n      // Guard: no calendars granted — nothing to ingest\n      if (calendarIds.length === 0) {\n        console.log('[Ingester] No calendars available');\n        return 0;\n      }\n      const events = await Calendar.getEventsAsync(calendarIds, start, end);\n      const {\n        routines,\n        patterns\n      } = (0, _onboardingSmartProcessing.extractCalendarPatterns)(events);\n      let count = 0;\n      for (const routine of routines) {\n        await (0, _pkg.storeFact)(userId, {\n          label: routine.title,\n          type: 'Event',\n          data: {\n            time: routine.time,\n            frequency: routine.frequency,\n            days: routine.days,\n            duration_minutes: routine.duration_minutes,\n            routine_type: routine.routine_type\n          },\n          confidence: 0.85,\n          provenance: 'CALENDAR'\n        });\n        count++;\n      }\n      for (const pattern of patterns) {\n        if (pattern.pattern_type === 'working_hours') {\n          await (0, _pkg.storeFact)(userId, {\n            label: `Working hours: ${pattern.time}`,\n            type: 'Trait',\n            data: {\n              time: pattern.time,\n              frequency: pattern.frequency\n            },\n            confidence: pattern.confidence,\n            provenance: 'CALENDAR'\n          });\n          count++;\n        }\n      }\n      console.log(`[Ingester] Imported ${count} calendar items into PKG`);\n      return count;\n    } catch (err) {\n      console.log('[Ingester] Calendar ingestion unavailable:', err);\n      return 0;\n    }\n  }\n\n  /**\n   * Run full Tier 1 ingestion (contacts + calendar).\n   * Called after user grants permissions during onboarding.\n   */\n  async function runTier1Ingestion(userId) {\n    const contacts = await ingestContacts(userId);\n    const calendar = await ingestCalendar(userId);\n    return {\n      contacts,\n      calendar\n    };\n  }\n});","lineCount":148,"map":[[7,2,19,0,"exports"],[7,9,19,0],[7,10,19,0,"ingestContacts"],[7,24,19,0],[7,27,19,0,"ingestContacts"],[7,41,19,0],[8,2,71,0,"exports"],[8,9,71,0],[8,10,71,0,"ingestCalendar"],[8,24,71,0],[8,27,71,0,"ingestCalendar"],[8,41,71,0],[9,2,139,0,"exports"],[9,9,139,0],[9,10,139,0,"runTier1Ingestion"],[9,27,139,0],[9,30,139,0,"runTier1Ingestion"],[9,47,139,0],[10,2,12,0],[10,6,12,0,"_pkg"],[10,10,12,0],[10,13,12,0,"require"],[10,20,12,0],[10,21,12,0,"_dependencyMap"],[10,35,12,0],[11,2,13,0],[11,6,13,0,"_onboardingSmartProcessing"],[11,32,13,0],[11,35,13,0,"require"],[11,42,13,0],[11,43,13,0,"_dependencyMap"],[11,57,13,0],[12,2,1,0],[13,0,2,0],[14,0,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[23,2,15,0],[24,0,16,0],[25,0,17,0],[26,0,18,0],[27,2,19,7],[27,17,19,22,"ingestContacts"],[27,31,19,36,"ingestContacts"],[27,32,19,37,"userId"],[27,38,19,51],[27,40,19,70],[28,4,20,2],[28,8,20,6],[29,6,21,4],[30,6,22,4],[30,12,22,10,"Contacts"],[30,20,22,18],[30,23,22,21,"require"],[30,30,22,28],[30,31,22,28,"_dependencyMap"],[30,45,22,28],[30,65,22,44],[30,66,22,45],[31,6,23,4],[31,12,23,10],[32,8,23,12,"status"],[33,6,23,19],[33,7,23,20],[33,10,23,23],[33,16,23,29,"Contacts"],[33,24,23,37],[33,25,23,38,"requestPermissionsAsync"],[33,48,23,61],[33,49,23,62],[33,50,23,63],[34,6,24,4],[34,10,24,8,"status"],[34,16,24,14],[34,21,24,19],[34,30,24,28],[34,32,24,30],[35,8,25,6,"console"],[35,15,25,13],[35,16,25,14,"log"],[35,19,25,17],[35,20,25,18],[35,59,25,57],[35,60,25,58],[36,8,26,6],[36,15,26,13],[36,16,26,14],[37,6,27,4],[38,6,29,4],[38,12,29,10],[39,8,29,12,"data"],[40,6,29,17],[40,7,29,18],[40,10,29,21],[40,16,29,27,"Contacts"],[40,24,29,35],[40,25,29,36,"getContactsAsync"],[40,41,29,52],[40,42,29,53],[41,8,30,6,"fields"],[41,14,30,12],[41,16,30,14],[41,17,31,8,"Contacts"],[41,25,31,16],[41,26,31,17,"Fields"],[41,32,31,23],[41,33,31,24,"Name"],[41,37,31,28],[41,39,32,8,"Contacts"],[41,47,32,16],[41,48,32,17,"Fields"],[41,54,32,23],[41,55,32,24,"Emails"],[41,61,32,30],[41,63,33,8,"Contacts"],[41,71,33,16],[41,72,33,17,"Fields"],[41,78,33,23],[41,79,33,24,"PhoneNumbers"],[41,91,33,36],[41,93,34,8,"Contacts"],[41,101,34,16],[41,102,34,17,"Fields"],[41,108,34,23],[41,109,34,24,"Company"],[41,116,34,31],[41,118,35,8,"Contacts"],[41,126,35,16],[41,127,35,17,"Fields"],[41,133,35,23],[41,134,35,24,"JobTitle"],[41,142,35,32],[42,6,37,4],[42,7,37,5],[42,8,37,6],[44,6,39,4],[45,6,40,4],[45,12,40,10,"scored"],[45,18,40,16],[45,21,40,19],[45,25,40,19,"scoreAndFilterContacts"],[45,51,40,41],[45,52,40,41,"scoreAndFilterContacts"],[45,74,40,41],[45,76,40,42,"data"],[45,80,40,46],[45,82,40,48],[45,84,40,50],[45,85,40,51],[46,6,42,4],[46,10,42,8,"count"],[46,15,42,13],[46,18,42,16],[46,19,42,17],[47,6,43,4],[47,11,43,9],[47,17,43,15,"contact"],[47,24,43,22],[47,28,43,26,"scored"],[47,34,43,32],[47,36,43,34],[48,8,44,6],[48,14,44,12],[48,18,44,12,"registerPerson"],[48,22,44,26],[48,23,44,26,"registerPerson"],[48,37,44,26],[48,39,45,8,"userId"],[48,45,45,14],[48,47,46,8,"contact"],[48,54,46,15],[48,55,46,16,"name"],[48,59,46,20],[48,61,47,8],[49,10,48,10,"email"],[49,15,48,15],[49,17,48,17,"contact"],[49,24,48,24],[49,25,48,25,"email"],[49,30,48,30],[50,10,49,10,"phone"],[50,15,49,15],[50,17,49,17,"contact"],[50,24,49,24],[50,25,49,25,"phone"],[50,30,49,30],[51,10,50,10,"role"],[51,14,50,14],[51,16,50,16,"contact"],[51,23,50,23],[51,24,50,24,"role"],[51,28,50,28],[52,10,51,10,"relationship"],[52,22,51,22],[52,24,51,24,"contact"],[52,31,51,31],[52,32,51,32,"relationship"],[52,44,51,44],[53,10,52,10,"company"],[53,17,52,17],[53,19,52,19,"contact"],[53,26,52,26],[53,27,52,27,"company"],[54,8,53,8],[54,9,53,9],[54,11,54,8],[54,21,55,6],[54,22,55,7],[55,8,56,6,"count"],[55,13,56,11],[55,15,56,13],[56,6,57,4],[57,6,59,4,"console"],[57,13,59,11],[57,14,59,12,"log"],[57,17,59,15],[57,18,59,16],[57,41,59,39,"count"],[57,46,59,44],[57,66,59,64],[57,67,59,65],[58,6,60,4],[58,13,60,11,"count"],[58,18,60,16],[59,4,61,2],[59,5,61,3],[59,6,61,4],[59,13,61,11,"err"],[59,16,61,14],[59,18,61,16],[60,6,62,4,"console"],[60,13,62,11],[60,14,62,12,"log"],[60,17,62,15],[60,18,62,16],[60,62,62,60],[60,64,62,62,"err"],[60,67,62,65],[60,68,62,66],[61,6,63,4],[61,13,63,11],[61,14,63,12],[62,4,64,2],[63,2,65,0],[65,2,67,0],[66,0,68,0],[67,0,69,0],[68,0,70,0],[69,2,71,7],[69,17,71,22,"ingestCalendar"],[69,31,71,36,"ingestCalendar"],[69,32,71,37,"userId"],[69,38,71,51],[69,40,71,70],[70,4,72,2],[70,8,72,6],[71,6,73,4],[71,12,73,10,"Calendar"],[71,20,73,18],[71,23,73,21,"require"],[71,30,73,28],[71,31,73,28,"_dependencyMap"],[71,45,73,28],[71,65,73,44],[71,66,73,45],[72,6,74,4],[72,12,74,10],[73,8,74,12,"status"],[74,6,74,19],[74,7,74,20],[74,10,74,23],[74,16,74,29,"Calendar"],[74,24,74,37],[74,25,74,38,"requestCalendarPermissionsAsync"],[74,56,74,69],[74,57,74,70],[74,58,74,71],[75,6,75,4],[75,10,75,8,"status"],[75,16,75,14],[75,21,75,19],[75,30,75,28],[75,32,75,30],[76,8,76,6,"console"],[76,15,76,13],[76,16,76,14,"log"],[76,19,76,17],[76,20,76,18],[76,59,76,57],[76,60,76,58],[77,8,77,6],[77,15,77,13],[77,16,77,14],[78,6,78,4],[80,6,80,4],[81,6,81,4],[81,12,81,10,"end"],[81,15,81,13],[81,18,81,16],[81,22,81,20,"Date"],[81,26,81,24],[81,27,81,25],[81,28,81,26],[82,6,82,4],[82,12,82,10,"start"],[82,17,82,15],[82,20,82,18],[82,24,82,22,"Date"],[82,28,82,26],[82,29,82,27,"end"],[82,32,82,30],[82,33,82,31,"getTime"],[82,40,82,38],[82,41,82,39],[82,42,82,40],[82,45,82,43],[82,47,82,45],[82,50,82,48],[82,52,82,50],[82,55,82,53],[82,57,82,55],[82,60,82,58],[82,62,82,60],[82,65,82,63],[82,69,82,67],[82,70,82,68],[83,6,83,4],[83,12,83,10,"calendars"],[83,21,83,19],[83,24,83,22],[83,30,83,28,"Calendar"],[83,38,83,36],[83,39,83,37,"getCalendarsAsync"],[83,56,83,54],[83,57,83,55,"Calendar"],[83,65,83,63],[83,66,83,64,"EntityTypes"],[83,77,83,75],[83,78,83,76,"EVENT"],[83,83,83,81],[83,84,83,82],[84,6,84,4],[84,12,84,10,"calendarIds"],[84,23,84,21],[84,26,84,24,"calendars"],[84,35,84,33],[84,36,84,34,"map"],[84,39,84,37],[84,40,84,39,"c"],[84,41,84,45],[84,45,84,50,"c"],[84,46,84,51],[84,47,84,52,"id"],[84,49,84,54],[84,50,84,55],[86,6,86,4],[87,6,87,4],[87,10,87,8,"calendarIds"],[87,21,87,19],[87,22,87,20,"length"],[87,28,87,26],[87,33,87,31],[87,34,87,32],[87,36,87,34],[88,8,88,6,"console"],[88,15,88,13],[88,16,88,14,"log"],[88,19,88,17],[88,20,88,18],[88,55,88,53],[88,56,88,54],[89,8,89,6],[89,15,89,13],[89,16,89,14],[90,6,90,4],[91,6,92,4],[91,12,92,10,"events"],[91,18,92,16],[91,21,92,19],[91,27,92,25,"Calendar"],[91,35,92,33],[91,36,92,34,"getEventsAsync"],[91,50,92,48],[91,51,92,49,"calendarIds"],[91,62,92,60],[91,64,92,62,"start"],[91,69,92,67],[91,71,92,69,"end"],[91,74,92,72],[91,75,92,73],[92,6,94,4],[92,12,94,10],[93,8,94,12,"routines"],[93,16,94,20],[94,8,94,22,"patterns"],[95,6,94,31],[95,7,94,32],[95,10,94,35],[95,14,94,35,"extractCalendarPatterns"],[95,40,94,58],[95,41,94,58,"extractCalendarPatterns"],[95,64,94,58],[95,66,94,59,"events"],[95,72,94,65],[95,73,94,66],[96,6,96,4],[96,10,96,8,"count"],[96,15,96,13],[96,18,96,16],[96,19,96,17],[97,6,97,4],[97,11,97,9],[97,17,97,15,"routine"],[97,24,97,22],[97,28,97,26,"routines"],[97,36,97,34],[97,38,97,36],[98,8,98,6],[98,14,98,12],[98,18,98,12,"storeFact"],[98,22,98,21],[98,23,98,21,"storeFact"],[98,32,98,21],[98,34,98,22,"userId"],[98,40,98,28],[98,42,98,30],[99,10,99,8,"label"],[99,15,99,13],[99,17,99,15,"routine"],[99,24,99,22],[99,25,99,23,"title"],[99,30,99,28],[100,10,100,8,"type"],[100,14,100,12],[100,16,100,14],[100,23,100,21],[101,10,101,8,"data"],[101,14,101,12],[101,16,101,14],[102,12,102,10,"time"],[102,16,102,14],[102,18,102,16,"routine"],[102,25,102,23],[102,26,102,24,"time"],[102,30,102,28],[103,12,103,10,"frequency"],[103,21,103,19],[103,23,103,21,"routine"],[103,30,103,28],[103,31,103,29,"frequency"],[103,40,103,38],[104,12,104,10,"days"],[104,16,104,14],[104,18,104,16,"routine"],[104,25,104,23],[104,26,104,24,"days"],[104,30,104,28],[105,12,105,10,"duration_minutes"],[105,28,105,26],[105,30,105,28,"routine"],[105,37,105,35],[105,38,105,36,"duration_minutes"],[105,54,105,52],[106,12,106,10,"routine_type"],[106,24,106,22],[106,26,106,24,"routine"],[106,33,106,31],[106,34,106,32,"routine_type"],[107,10,107,8],[107,11,107,9],[108,10,108,8,"confidence"],[108,20,108,18],[108,22,108,20],[108,26,108,24],[109,10,109,8,"provenance"],[109,20,109,18],[109,22,109,20],[110,8,110,6],[110,9,110,7],[110,10,110,8],[111,8,111,6,"count"],[111,13,111,11],[111,15,111,13],[112,6,112,4],[113,6,114,4],[113,11,114,9],[113,17,114,15,"pattern"],[113,24,114,22],[113,28,114,26,"patterns"],[113,36,114,34],[113,38,114,36],[114,8,115,6],[114,12,115,10,"pattern"],[114,19,115,17],[114,20,115,18,"pattern_type"],[114,32,115,30],[114,37,115,35],[114,52,115,50],[114,54,115,52],[115,10,116,8],[115,16,116,14],[115,20,116,14,"storeFact"],[115,24,116,23],[115,25,116,23,"storeFact"],[115,34,116,23],[115,36,116,24,"userId"],[115,42,116,30],[115,44,116,32],[116,12,117,10,"label"],[116,17,117,15],[116,19,117,17],[116,37,117,35,"pattern"],[116,44,117,42],[116,45,117,43,"time"],[116,49,117,47],[116,51,117,49],[117,12,118,10,"type"],[117,16,118,14],[117,18,118,16],[117,25,118,23],[118,12,119,10,"data"],[118,16,119,14],[118,18,119,16],[119,14,119,18,"time"],[119,18,119,22],[119,20,119,24,"pattern"],[119,27,119,31],[119,28,119,32,"time"],[119,32,119,36],[120,14,119,38,"frequency"],[120,23,119,47],[120,25,119,49,"pattern"],[120,32,119,56],[120,33,119,57,"frequency"],[121,12,119,67],[121,13,119,68],[122,12,120,10,"confidence"],[122,22,120,20],[122,24,120,22,"pattern"],[122,31,120,29],[122,32,120,30,"confidence"],[122,42,120,40],[123,12,121,10,"provenance"],[123,22,121,20],[123,24,121,22],[124,10,122,8],[124,11,122,9],[124,12,122,10],[125,10,123,8,"count"],[125,15,123,13],[125,17,123,15],[126,8,124,6],[127,6,125,4],[128,6,127,4,"console"],[128,13,127,11],[128,14,127,12,"log"],[128,17,127,15],[128,18,127,16],[128,41,127,39,"count"],[128,46,127,44],[128,72,127,70],[128,73,127,71],[129,6,128,4],[129,13,128,11,"count"],[129,18,128,16],[130,4,129,2],[130,5,129,3],[130,6,129,4],[130,13,129,11,"err"],[130,16,129,14],[130,18,129,16],[131,6,130,4,"console"],[131,13,130,11],[131,14,130,12,"log"],[131,17,130,15],[131,18,130,16],[131,62,130,60],[131,64,130,62,"err"],[131,67,130,65],[131,68,130,66],[132,6,131,4],[132,13,131,11],[132,14,131,12],[133,4,132,2],[134,2,133,0],[136,2,135,0],[137,0,136,0],[138,0,137,0],[139,0,138,0],[140,2,139,7],[140,17,139,22,"runTier1Ingestion"],[140,34,139,39,"runTier1Ingestion"],[140,35,139,40,"userId"],[140,41,139,54],[140,43,139,105],[141,4,140,2],[141,10,140,8,"contacts"],[141,18,140,16],[141,21,140,19],[141,27,140,25,"ingestContacts"],[141,41,140,39],[141,42,140,40,"userId"],[141,48,140,46],[141,49,140,47],[142,4,141,2],[142,10,141,8,"calendar"],[142,18,141,16],[142,21,141,19],[142,27,141,25,"ingestCalendar"],[142,41,141,39],[142,42,141,40,"userId"],[142,48,141,46],[142,49,141,47],[143,4,142,2],[143,11,142,9],[144,6,142,11,"contacts"],[144,14,142,19],[145,6,142,21,"calendar"],[146,4,142,30],[146,5,142,31],[147,2,143,0],[148,0,143,1],[148,3]],"functionMap":{"names":["<global>","ingestContacts","ingestCalendar","calendars.map$argument_0","runTier1Ingestion"],"mappings":"AAA;OCkB;CD8C;OEM;sCCa,gBD;CFiD;OIM;CJI"},"hasCjsExports":false},"type":"js/module"}]}