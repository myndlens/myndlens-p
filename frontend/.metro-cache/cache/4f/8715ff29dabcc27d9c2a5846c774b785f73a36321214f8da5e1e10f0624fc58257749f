{"dependencies":[{"name":"../config/env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":264},"end":{"line":11,"column":36,"index":300}}],"key":"RGB4LNLgNgEtjcVNHbEAgFn5Y3M=","exportNames":["*"],"imports":1}},{"name":"./auth","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":301},"end":{"line":12,"column":61,"index":362}}],"key":"bPsbxvG/upGRzIWg1D65yZCgVZE=","exportNames":["*"],"imports":1}},{"name":"../digital-self/pkg","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":238,"column":26,"index":7338},"end":{"line":238,"column":56,"index":7368}}],"key":"UJmT24Ec+/AxLIkxT2J+TUQ2KkA=","exportNames":["*"],"imports":1,"isOptional":true}},{"name":"../digital-self/sync","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":239,"column":29,"index":7399},"end":{"line":239,"column":60,"index":7430}}],"key":"0xXQyM4XHrm3FcELV8MK3J1z7SQ=","exportNames":["*"],"imports":1,"isOptional":true}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"MyndLensWSClient\", {\n    enumerable: true,\n    get: function () {\n      return MyndLensWSClient;\n    }\n  });\n  Object.defineProperty(exports, \"wsClient\", {\n    enumerable: true,\n    get: function () {\n      return wsClient;\n    }\n  });\n  var _configEnv = require(_dependencyMap[0], \"../config/env\");\n  var _auth = require(_dependencyMap[1], \"./auth\");\n  /**\n   * WebSocket client — connects to MyndLens BE with auth.\n   *\n   * Protocol:\n   * 1. Connect to WS endpoint\n   * 2. Send AUTH message with token + device_id\n   * 3. Receive AUTH_OK with session_id\n   * 4. Start heartbeat loop\n   * 5. Route incoming messages to handlers\n   */\n\n  // Device → Backend: here is the readable text for those nodes\n\n  class MyndLensWSClient {\n    ws = null;\n    sessionId = null;\n    handlers = new Map();\n    heartbeatTimer = null;\n    heartbeatSeq = 0;\n    _isConnected = false;\n    _isAuthenticated = false;\n    _userId = null;\n    get isConnected() {\n      return this._isConnected;\n    }\n    get isAuthenticated() {\n      return this._isAuthenticated;\n    }\n    get currentSessionId() {\n      return this.sessionId;\n    }\n    get userId() {\n      return this._userId;\n    }\n\n    /**\n     * Register a handler for a specific message type.\n     */\n    on(type, handler) {\n      const existing = this.handlers.get(type) || [];\n      existing.push(handler);\n      this.handlers.set(type, existing);\n      // Return unsubscribe function\n      return () => {\n        const handlers = this.handlers.get(type) || [];\n        const idx = handlers.indexOf(handler);\n        if (idx >= 0) handlers.splice(idx, 1);\n      };\n    }\n\n    /**\n     * Connect to the WebSocket server.\n     */\n    async connect() {\n      if (this.ws) {\n        this.disconnect();\n      }\n      return new Promise(async (resolve, reject) => {\n        try {\n          const token = await (0, _auth.getStoredToken)();\n          if (!token) {\n            reject(new Error('No auth token available. Pair device first.'));\n            return;\n          }\n          const deviceId = await (0, _auth.getOrCreateDeviceId)();\n          const wsUrl = _configEnv.ENV.WS_URL;\n          console.log('[WS] Connecting to', wsUrl);\n          this.ws = new WebSocket(wsUrl);\n          this.ws.onopen = () => {\n            console.log('[WS] Connected, sending AUTH');\n            this._isConnected = true;\n\n            // Send AUTH message\n            this.send('auth', {\n              token,\n              device_id: deviceId,\n              client_version: '1.0.0'\n            });\n          };\n          this.ws.onmessage = event => {\n            try {\n              const envelope = JSON.parse(event.data);\n              this._routeMessage(envelope, resolve, reject);\n            } catch (err) {\n              console.error('[WS] Failed to parse message:', err);\n            }\n          };\n          this.ws.onclose = event => {\n            console.log('[WS] Closed:', event.code, event.reason);\n            this._cleanup();\n            this._dispatch('session_terminated', {\n              type: 'session_terminated',\n              id: '',\n              timestamp: new Date().toISOString(),\n              payload: {\n                code: event.code,\n                reason: event.reason\n              }\n            });\n            // Auto-reconnect is intentionally NOT here.\n            // loading.tsx is the single authority for reconnection.\n            // Dual reconnect (here + loading.tsx) causes race conditions and stuck states.\n          };\n          this.ws.onerror = error => {\n            console.warn('[WS] Connection error (non-fatal):', error?.type || 'unknown');\n            // Don't reject - let onclose handle reconnection\n          };\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n\n    /**\n     * Send a typed message to the server.\n     */\n    send(type, payload = {}) {\n      if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n        console.warn('[WS] Cannot send, not connected');\n        return;\n      }\n      const envelope = {\n        type,\n        id: Math.random().toString(36).substring(2),\n        timestamp: new Date().toISOString(),\n        payload\n      };\n      this.ws.send(JSON.stringify(envelope));\n    }\n\n    /**\n     * Send an execute request (with presence gate on server).\n     */\n    sendExecuteRequest(draftId, touchToken) {\n      this.send('execute_request', {\n        session_id: this.sessionId,\n        draft_id: draftId,\n        touch_token: touchToken || null\n      });\n    }\n\n    /**\n     * Disconnect and cleanup.\n     */\n    disconnect() {\n      if (this.ws) {\n        this.ws.close(1000, 'Client disconnect');\n      }\n      this._cleanup();\n    }\n\n    // ---- Private ----\n\n    _routeMessage(envelope, resolve, reject) {\n      const {\n        type\n      } = envelope;\n      switch (type) {\n        case 'auth_ok':\n          this.sessionId = envelope.payload.session_id;\n          this._userId = envelope.payload.user_id;\n          this._isAuthenticated = true;\n          this._startHeartbeat(envelope.payload.heartbeat_interval_ms || _configEnv.ENV.HEARTBEAT_INTERVAL_MS);\n          console.log('[WS] Authenticated, session:', this.sessionId);\n          resolve?.();\n          break;\n        case 'auth_fail':\n          console.error('[WS] Auth failed:', envelope.payload.reason);\n          this._isAuthenticated = false;\n          reject?.(new Error(envelope.payload.reason));\n          break;\n        case 'heartbeat_ack':\n          // Heartbeat acknowledged — no action needed\n          break;\n        case 'ds_resolve':\n          {\n            // Backend matched vector nodes and needs us to provide the readable text.\n            // Look up node IDs in local PKG, send back { nodes: [{id, text}] }.\n            const nodeIds = envelope.payload.node_ids ?? [];\n            const sessionId = envelope.payload.session_id ?? this.sessionId ?? '';\n            if (nodeIds.length > 0 && sessionId) {\n              this._handleDsResolve(nodeIds, sessionId).catch(err => {\n                console.log('[WS] ds_resolve handler error:', err);\n              });\n            }\n            break;\n          }\n        default:\n          break;\n      }\n\n      // Dispatch to registered handlers\n      this._dispatch(type, envelope);\n    }\n    _dispatch(type, envelope) {\n      const handlers = this.handlers.get(type) || [];\n      for (const handler of handlers) {\n        try {\n          handler(envelope);\n        } catch (err) {\n          console.error(`[WS] Handler error for ${type}:`, err);\n        }\n      }\n    }\n\n    /**\n     * Handle ds_resolve: backend matched vector node IDs and needs readable text.\n     * Look up each node_id in the local PKG, return the text-only representation.\n     * Responds immediately with ds_context — keeps pipeline latency minimal.\n     */\n    async _handleDsResolve(nodeIds, sessionId) {\n      try {\n        const userId = this._userId ?? '';\n        if (!userId) return;\n        const {\n          loadPKG\n        } = require(_dependencyMap[2], \"../digital-self/pkg\");\n        const {\n          nodeToText\n        } = require(_dependencyMap[3], \"../digital-self/sync\");\n        const pkg = await loadPKG(userId);\n        const nodes = nodeIds.filter(id => pkg.nodes[id]).map(id => ({\n          id,\n          text: nodeToText(pkg.nodes[id])\n        }));\n        this.send('ds_context', {\n          session_id: sessionId,\n          nodes\n        });\n        console.log(`[WS] ds_context sent: ${nodes.length} nodes resolved`);\n      } catch (err) {\n        console.log('[WS] ds_resolve lookup failed:', err);\n        // Send empty ds_context so backend doesn't time out waiting\n        this.send('ds_context', {\n          session_id: sessionId,\n          nodes: []\n        });\n      }\n    }\n    _startHeartbeat(intervalMs) {\n      this._stopHeartbeat();\n      this.heartbeatSeq = 0;\n      this.heartbeatTimer = setInterval(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN && this.sessionId) {\n          this.heartbeatSeq++;\n          this.send('heartbeat', {\n            session_id: this.sessionId,\n            seq: this.heartbeatSeq,\n            client_ts: new Date().toISOString()\n          });\n        }\n      }, intervalMs);\n      console.log(`[WS] Heartbeat started: ${intervalMs}ms interval`);\n    }\n    _stopHeartbeat() {\n      if (this.heartbeatTimer) {\n        clearInterval(this.heartbeatTimer);\n        this.heartbeatTimer = null;\n      }\n    }\n    _cleanup() {\n      this._stopHeartbeat();\n      this._isConnected = false;\n      this._isAuthenticated = false;\n      this.sessionId = null;\n      this.ws = null;\n    }\n  }\n\n  // Singleton instance\n  const wsClient = new MyndLensWSClient();\n});","lineCount":292,"map":[[7,2,33,0,"Object"],[7,8,33,0],[7,9,33,0,"defineProperty"],[7,23,33,0],[7,24,33,0,"exports"],[7,31,33,0],[8,4,33,0,"enumerable"],[8,14,33,0],[9,4,33,0,"get"],[9,7,33,0],[9,18,33,0,"get"],[9,19,33,0],[10,6,33,0],[10,13,33,0,"MyndLensWSClient"],[10,29,33,0],[11,4,33,0],[12,2,33,0],[13,2,297,0,"Object"],[13,8,297,0],[13,9,297,0,"defineProperty"],[13,23,297,0],[13,24,297,0,"exports"],[13,31,297,0],[14,4,297,0,"enumerable"],[14,14,297,0],[15,4,297,0,"get"],[15,7,297,0],[15,18,297,0,"get"],[15,19,297,0],[16,6,297,0],[16,13,297,0,"wsClient"],[16,21,297,0],[17,4,297,0],[18,2,297,0],[19,2,11,0],[19,6,11,0,"_configEnv"],[19,16,11,0],[19,19,11,0,"require"],[19,26,11,0],[19,27,11,0,"_dependencyMap"],[19,41,11,0],[20,2,12,0],[20,6,12,0,"_auth"],[20,11,12,0],[20,14,12,0,"require"],[20,21,12,0],[20,22,12,0,"_dependencyMap"],[20,36,12,0],[21,2,1,0],[22,0,2,0],[23,0,3,0],[24,0,4,0],[25,0,5,0],[26,0,6,0],[27,0,7,0],[28,0,8,0],[29,0,9,0],[30,0,10,0],[32,2,22,20],[34,2,33,7],[34,8,33,13,"MyndLensWSClient"],[34,24,33,29],[34,25,33,30],[35,4,34,10,"ws"],[35,6,34,12],[35,9,34,33],[35,13,34,37],[36,4,35,10,"sessionId"],[36,13,35,19],[36,16,35,37],[36,20,35,41],[37,4,36,10,"handlers"],[37,12,36,18],[37,15,36,61],[37,19,36,65,"Map"],[37,22,36,68],[37,23,36,69],[37,24,36,70],[38,4,37,10,"heartbeatTimer"],[38,18,37,24],[38,21,37,66],[38,25,37,70],[39,4,38,10,"heartbeatSeq"],[39,16,38,22],[39,19,38,33],[39,20,38,34],[40,4,39,10,"_isConnected"],[40,16,39,22],[40,19,39,34],[40,24,39,39],[41,4,40,10,"_isAuthenticated"],[41,20,40,26],[41,23,40,38],[41,28,40,43],[42,4,41,10,"_userId"],[42,11,41,17],[42,14,41,35],[42,18,41,39],[43,4,43,2],[43,8,43,6,"isConnected"],[43,19,43,17,"isConnected"],[43,20,43,17],[43,22,43,29],[44,6,43,31],[44,13,43,38],[44,17,43,42],[44,18,43,43,"_isConnected"],[44,30,43,55],[45,4,43,57],[46,4,44,2],[46,8,44,6,"isAuthenticated"],[46,23,44,21,"isAuthenticated"],[46,24,44,21],[46,26,44,33],[47,6,44,35],[47,13,44,42],[47,17,44,46],[47,18,44,47,"_isAuthenticated"],[47,34,44,63],[48,4,44,65],[49,4,45,2],[49,8,45,6,"currentSessionId"],[49,24,45,22,"currentSessionId"],[49,25,45,22],[49,27,45,40],[50,6,45,42],[50,13,45,49],[50,17,45,53],[50,18,45,54,"sessionId"],[50,27,45,63],[51,4,45,65],[52,4,46,2],[52,8,46,6,"userId"],[52,14,46,12,"userId"],[52,15,46,12],[52,17,46,30],[53,6,46,32],[53,13,46,39],[53,17,46,43],[53,18,46,44,"_userId"],[53,25,46,51],[54,4,46,53],[56,4,48,2],[57,0,49,0],[58,0,50,0],[59,4,51,2,"on"],[59,6,51,4,"on"],[59,7,51,5,"type"],[59,11,51,24],[59,13,51,26,"handler"],[59,20,51,51],[59,22,51,65],[60,6,52,4],[60,12,52,10,"existing"],[60,20,52,18],[60,23,52,21],[60,27,52,25],[60,28,52,26,"handlers"],[60,36,52,34],[60,37,52,35,"get"],[60,40,52,38],[60,41,52,39,"type"],[60,45,52,43],[60,46,52,44],[60,50,52,48],[60,52,52,50],[61,6,53,4,"existing"],[61,14,53,12],[61,15,53,13,"push"],[61,19,53,17],[61,20,53,18,"handler"],[61,27,53,25],[61,28,53,26],[62,6,54,4],[62,10,54,8],[62,11,54,9,"handlers"],[62,19,54,17],[62,20,54,18,"set"],[62,23,54,21],[62,24,54,22,"type"],[62,28,54,26],[62,30,54,28,"existing"],[62,38,54,36],[62,39,54,37],[63,6,55,4],[64,6,56,4],[64,13,56,11],[64,19,56,17],[65,8,57,6],[65,14,57,12,"handlers"],[65,22,57,20],[65,25,57,23],[65,29,57,27],[65,30,57,28,"handlers"],[65,38,57,36],[65,39,57,37,"get"],[65,42,57,40],[65,43,57,41,"type"],[65,47,57,45],[65,48,57,46],[65,52,57,50],[65,54,57,52],[66,8,58,6],[66,14,58,12,"idx"],[66,17,58,15],[66,20,58,18,"handlers"],[66,28,58,26],[66,29,58,27,"indexOf"],[66,36,58,34],[66,37,58,35,"handler"],[66,44,58,42],[66,45,58,43],[67,8,59,6],[67,12,59,10,"idx"],[67,15,59,13],[67,19,59,17],[67,20,59,18],[67,22,59,20,"handlers"],[67,30,59,28],[67,31,59,29,"splice"],[67,37,59,35],[67,38,59,36,"idx"],[67,41,59,39],[67,43,59,41],[67,44,59,42],[67,45,59,43],[68,6,60,4],[68,7,60,5],[69,4,61,2],[71,4,63,2],[72,0,64,0],[73,0,65,0],[74,4,66,2],[74,10,66,8,"connect"],[74,17,66,15,"connect"],[74,18,66,15],[74,20,66,33],[75,6,67,4],[75,10,67,8],[75,14,67,12],[75,15,67,13,"ws"],[75,17,67,15],[75,19,67,17],[76,8,68,6],[76,12,68,10],[76,13,68,11,"disconnect"],[76,23,68,21],[76,24,68,22],[76,25,68,23],[77,6,69,4],[78,6,71,4],[78,13,71,11],[78,17,71,15,"Promise"],[78,24,71,22],[78,25,71,23],[78,32,71,30,"resolve"],[78,39,71,37],[78,41,71,39,"reject"],[78,47,71,45],[78,52,71,50],[79,8,72,6],[79,12,72,10],[80,10,73,8],[80,16,73,14,"token"],[80,21,73,19],[80,24,73,22],[80,30,73,28],[80,34,73,28,"getStoredToken"],[80,39,73,42],[80,40,73,42,"getStoredToken"],[80,54,73,42],[80,56,73,43],[80,57,73,44],[81,10,74,8],[81,14,74,12],[81,15,74,13,"token"],[81,20,74,18],[81,22,74,20],[82,12,75,10,"reject"],[82,18,75,16],[82,19,75,17],[82,23,75,21,"Error"],[82,28,75,26],[82,29,75,27],[82,74,75,72],[82,75,75,73],[82,76,75,74],[83,12,76,10],[84,10,77,8],[85,10,79,8],[85,16,79,14,"deviceId"],[85,24,79,22],[85,27,79,25],[85,33,79,31],[85,37,79,31,"getOrCreateDeviceId"],[85,42,79,50],[85,43,79,50,"getOrCreateDeviceId"],[85,62,79,50],[85,64,79,51],[85,65,79,52],[86,10,80,8],[86,16,80,14,"wsUrl"],[86,21,80,19],[86,24,80,22,"ENV"],[86,34,80,25],[86,35,80,25,"ENV"],[86,38,80,25],[86,39,80,26,"WS_URL"],[86,45,80,32],[87,10,82,8,"console"],[87,17,82,15],[87,18,82,16,"log"],[87,21,82,19],[87,22,82,20],[87,42,82,40],[87,44,82,42,"wsUrl"],[87,49,82,47],[87,50,82,48],[88,10,83,8],[88,14,83,12],[88,15,83,13,"ws"],[88,17,83,15],[88,20,83,18],[88,24,83,22,"WebSocket"],[88,33,83,31],[88,34,83,32,"wsUrl"],[88,39,83,37],[88,40,83,38],[89,10,85,8],[89,14,85,12],[89,15,85,13,"ws"],[89,17,85,15],[89,18,85,16,"onopen"],[89,24,85,22],[89,27,85,25],[89,33,85,31],[90,12,86,10,"console"],[90,19,86,17],[90,20,86,18,"log"],[90,23,86,21],[90,24,86,22],[90,54,86,52],[90,55,86,53],[91,12,87,10],[91,16,87,14],[91,17,87,15,"_isConnected"],[91,29,87,27],[91,32,87,30],[91,36,87,34],[93,12,89,10],[94,12,90,10],[94,16,90,14],[94,17,90,15,"send"],[94,21,90,19],[94,22,90,20],[94,28,90,26],[94,30,90,28],[95,14,91,12,"token"],[95,19,91,17],[96,14,92,12,"device_id"],[96,23,92,21],[96,25,92,23,"deviceId"],[96,33,92,31],[97,14,93,12,"client_version"],[97,28,93,26],[97,30,93,28],[98,12,94,10],[98,13,94,11],[98,14,94,12],[99,10,95,8],[99,11,95,9],[100,10,97,8],[100,14,97,12],[100,15,97,13,"ws"],[100,17,97,15],[100,18,97,16,"onmessage"],[100,27,97,25],[100,30,97,29,"event"],[100,35,97,34],[100,39,97,39],[101,12,98,10],[101,16,98,14],[102,14,99,12],[102,20,99,18,"envelope"],[102,28,99,38],[102,31,99,41,"JSON"],[102,35,99,45],[102,36,99,46,"parse"],[102,41,99,51],[102,42,99,52,"event"],[102,47,99,57],[102,48,99,58,"data"],[102,52,99,62],[102,53,99,63],[103,14,100,12],[103,18,100,16],[103,19,100,17,"_routeMessage"],[103,32,100,30],[103,33,100,31,"envelope"],[103,41,100,39],[103,43,100,41,"resolve"],[103,50,100,48],[103,52,100,50,"reject"],[103,58,100,56],[103,59,100,57],[104,12,101,10],[104,13,101,11],[104,14,101,12],[104,21,101,19,"err"],[104,24,101,22],[104,26,101,24],[105,14,102,12,"console"],[105,21,102,19],[105,22,102,20,"error"],[105,27,102,25],[105,28,102,26],[105,59,102,57],[105,61,102,59,"err"],[105,64,102,62],[105,65,102,63],[106,12,103,10],[107,10,104,8],[107,11,104,9],[108,10,106,8],[108,14,106,12],[108,15,106,13,"ws"],[108,17,106,15],[108,18,106,16,"onclose"],[108,25,106,23],[108,28,106,27,"event"],[108,33,106,32],[108,37,106,37],[109,12,107,10,"console"],[109,19,107,17],[109,20,107,18,"log"],[109,23,107,21],[109,24,107,22],[109,38,107,36],[109,40,107,38,"event"],[109,45,107,43],[109,46,107,44,"code"],[109,50,107,48],[109,52,107,50,"event"],[109,57,107,55],[109,58,107,56,"reason"],[109,64,107,62],[109,65,107,63],[110,12,108,10],[110,16,108,14],[110,17,108,15,"_cleanup"],[110,25,108,23],[110,26,108,24],[110,27,108,25],[111,12,109,10],[111,16,109,14],[111,17,109,15,"_dispatch"],[111,26,109,24],[111,27,109,25],[111,47,109,45],[111,49,109,47],[112,14,110,12,"type"],[112,18,110,16],[112,20,110,18],[112,40,110,38],[113,14,111,12,"id"],[113,16,111,14],[113,18,111,16],[113,20,111,18],[114,14,112,12,"timestamp"],[114,23,112,21],[114,25,112,23],[114,29,112,27,"Date"],[114,33,112,31],[114,34,112,32],[114,35,112,33],[114,36,112,34,"toISOString"],[114,47,112,45],[114,48,112,46],[114,49,112,47],[115,14,113,12,"payload"],[115,21,113,19],[115,23,113,21],[116,16,113,23,"code"],[116,20,113,27],[116,22,113,29,"event"],[116,27,113,34],[116,28,113,35,"code"],[116,32,113,39],[117,16,113,41,"reason"],[117,22,113,47],[117,24,113,49,"event"],[117,29,113,54],[117,30,113,55,"reason"],[118,14,113,62],[119,12,114,10],[119,13,114,11],[119,14,114,12],[120,12,115,10],[121,12,116,10],[122,12,117,10],[123,10,118,8],[123,11,118,9],[124,10,120,8],[124,14,120,12],[124,15,120,13,"ws"],[124,17,120,15],[124,18,120,16,"onerror"],[124,25,120,23],[124,28,120,27,"error"],[124,33,120,32],[124,37,120,37],[125,12,121,10,"console"],[125,19,121,17],[125,20,121,18,"warn"],[125,24,121,22],[125,25,121,23],[125,61,121,59],[125,63,121,61,"error"],[125,68,121,66],[125,70,121,68,"type"],[125,74,121,72],[125,78,121,76],[125,87,121,85],[125,88,121,86],[126,12,122,10],[127,10,123,8],[127,11,123,9],[128,8,125,6],[128,9,125,7],[128,10,125,8],[128,17,125,15,"err"],[128,20,125,18],[128,22,125,20],[129,10,126,8,"reject"],[129,16,126,14],[129,17,126,15,"err"],[129,20,126,18],[129,21,126,19],[130,8,127,6],[131,6,128,4],[131,7,128,5],[131,8,128,6],[132,4,129,2],[134,4,131,2],[135,0,132,0],[136,0,133,0],[137,4,134,2,"send"],[137,8,134,6,"send"],[137,9,134,7,"type"],[137,13,134,26],[137,15,134,28,"payload"],[137,22,134,56],[137,25,134,59],[137,26,134,60],[137,27,134,61],[137,29,134,69],[138,6,135,4],[138,10,135,8],[138,11,135,9],[138,15,135,13],[138,16,135,14,"ws"],[138,18,135,16],[138,22,135,20],[138,26,135,24],[138,27,135,25,"ws"],[138,29,135,27],[138,30,135,28,"readyState"],[138,40,135,38],[138,45,135,43,"WebSocket"],[138,54,135,52],[138,55,135,53,"OPEN"],[138,59,135,57],[138,61,135,59],[139,8,136,6,"console"],[139,15,136,13],[139,16,136,14,"warn"],[139,20,136,18],[139,21,136,19],[139,54,136,52],[139,55,136,53],[140,8,137,6],[141,6,138,4],[142,6,140,4],[142,12,140,10,"envelope"],[142,20,140,30],[142,23,140,33],[143,8,141,6,"type"],[143,12,141,10],[144,8,142,6,"id"],[144,10,142,8],[144,12,142,10,"Math"],[144,16,142,14],[144,17,142,15,"random"],[144,23,142,21],[144,24,142,22],[144,25,142,23],[144,26,142,24,"toString"],[144,34,142,32],[144,35,142,33],[144,37,142,35],[144,38,142,36],[144,39,142,37,"substring"],[144,48,142,46],[144,49,142,47],[144,50,142,48],[144,51,142,49],[145,8,143,6,"timestamp"],[145,17,143,15],[145,19,143,17],[145,23,143,21,"Date"],[145,27,143,25],[145,28,143,26],[145,29,143,27],[145,30,143,28,"toISOString"],[145,41,143,39],[145,42,143,40],[145,43,143,41],[146,8,144,6,"payload"],[147,6,145,4],[147,7,145,5],[148,6,147,4],[148,10,147,8],[148,11,147,9,"ws"],[148,13,147,11],[148,14,147,12,"send"],[148,18,147,16],[148,19,147,17,"JSON"],[148,23,147,21],[148,24,147,22,"stringify"],[148,33,147,31],[148,34,147,32,"envelope"],[148,42,147,40],[148,43,147,41],[148,44,147,42],[149,4,148,2],[151,4,150,2],[152,0,151,0],[153,0,152,0],[154,4,153,2,"sendExecuteRequest"],[154,22,153,20,"sendExecuteRequest"],[154,23,153,21,"draftId"],[154,30,153,36],[154,32,153,38,"touchToken"],[154,42,153,57],[154,44,153,65],[155,6,154,4],[155,10,154,8],[155,11,154,9,"send"],[155,15,154,13],[155,16,154,14],[155,33,154,31],[155,35,154,33],[156,8,155,6,"session_id"],[156,18,155,16],[156,20,155,18],[156,24,155,22],[156,25,155,23,"sessionId"],[156,34,155,32],[157,8,156,6,"draft_id"],[157,16,156,14],[157,18,156,16,"draftId"],[157,25,156,23],[158,8,157,6,"touch_token"],[158,19,157,17],[158,21,157,19,"touchToken"],[158,31,157,29],[158,35,157,33],[159,6,158,4],[159,7,158,5],[159,8,158,6],[160,4,159,2],[162,4,161,2],[163,0,162,0],[164,0,163,0],[165,4,164,2,"disconnect"],[165,14,164,12,"disconnect"],[165,15,164,12],[165,17,164,21],[166,6,165,4],[166,10,165,8],[166,14,165,12],[166,15,165,13,"ws"],[166,17,165,15],[166,19,165,17],[167,8,166,6],[167,12,166,10],[167,13,166,11,"ws"],[167,15,166,13],[167,16,166,14,"close"],[167,21,166,19],[167,22,166,20],[167,26,166,24],[167,28,166,26],[167,47,166,45],[167,48,166,46],[168,6,167,4],[169,6,168,4],[169,10,168,8],[169,11,168,9,"_cleanup"],[169,19,168,17],[169,20,168,18],[169,21,168,19],[170,4,169,2],[172,4,171,2],[174,4,173,10,"_routeMessage"],[174,17,173,23,"_routeMessage"],[174,18,173,24,"envelope"],[174,26,173,44],[174,28,173,46,"resolve"],[174,35,173,64],[174,37,173,66,"reject"],[174,43,173,83],[174,45,173,91],[175,6,174,4],[175,12,174,10],[176,8,174,12,"type"],[177,6,174,17],[177,7,174,18],[177,10,174,21,"envelope"],[177,18,174,29],[178,6,176,4],[178,14,176,12,"type"],[178,18,176,16],[179,8,177,6],[179,13,177,11],[179,22,177,20],[180,10,178,8],[180,14,178,12],[180,15,178,13,"sessionId"],[180,24,178,22],[180,27,178,25,"envelope"],[180,35,178,33],[180,36,178,34,"payload"],[180,43,178,41],[180,44,178,42,"session_id"],[180,54,178,52],[181,10,179,8],[181,14,179,12],[181,15,179,13,"_userId"],[181,22,179,20],[181,25,179,23,"envelope"],[181,33,179,31],[181,34,179,32,"payload"],[181,41,179,39],[181,42,179,40,"user_id"],[181,49,179,47],[182,10,180,8],[182,14,180,12],[182,15,180,13,"_isAuthenticated"],[182,31,180,29],[182,34,180,32],[182,38,180,36],[183,10,181,8],[183,14,181,12],[183,15,181,13,"_startHeartbeat"],[183,30,181,28],[183,31,181,29,"envelope"],[183,39,181,37],[183,40,181,38,"payload"],[183,47,181,45],[183,48,181,46,"heartbeat_interval_ms"],[183,69,181,67],[183,73,181,71,"ENV"],[183,83,181,74],[183,84,181,74,"ENV"],[183,87,181,74],[183,88,181,75,"HEARTBEAT_INTERVAL_MS"],[183,109,181,96],[183,110,181,97],[184,10,182,8,"console"],[184,17,182,15],[184,18,182,16,"log"],[184,21,182,19],[184,22,182,20],[184,52,182,50],[184,54,182,52],[184,58,182,56],[184,59,182,57,"sessionId"],[184,68,182,66],[184,69,182,67],[185,10,183,8,"resolve"],[185,17,183,15],[185,20,183,18],[185,21,183,19],[186,10,184,8],[187,8,186,6],[187,13,186,11],[187,24,186,22],[188,10,187,8,"console"],[188,17,187,15],[188,18,187,16,"error"],[188,23,187,21],[188,24,187,22],[188,43,187,41],[188,45,187,43,"envelope"],[188,53,187,51],[188,54,187,52,"payload"],[188,61,187,59],[188,62,187,60,"reason"],[188,68,187,66],[188,69,187,67],[189,10,188,8],[189,14,188,12],[189,15,188,13,"_isAuthenticated"],[189,31,188,29],[189,34,188,32],[189,39,188,37],[190,10,189,8,"reject"],[190,16,189,14],[190,19,189,17],[190,23,189,21,"Error"],[190,28,189,26],[190,29,189,27,"envelope"],[190,37,189,35],[190,38,189,36,"payload"],[190,45,189,43],[190,46,189,44,"reason"],[190,52,189,50],[190,53,189,51],[190,54,189,52],[191,10,190,8],[192,8,192,6],[192,13,192,11],[192,28,192,26],[193,10,193,8],[194,10,194,8],[195,8,196,6],[195,13,196,11],[195,25,196,23],[196,10,196,25],[197,12,197,8],[198,12,198,8],[199,12,199,8],[199,18,199,14,"nodeIds"],[199,25,199,31],[199,28,199,34,"envelope"],[199,36,199,42],[199,37,199,43,"payload"],[199,44,199,50],[199,45,199,51,"node_ids"],[199,53,199,59],[199,57,199,63],[199,59,199,65],[200,12,200,8],[200,18,200,14,"sessionId"],[200,27,200,31],[200,30,200,34,"envelope"],[200,38,200,42],[200,39,200,43,"payload"],[200,46,200,50],[200,47,200,51,"session_id"],[200,57,200,61],[200,61,200,65],[200,65,200,69],[200,66,200,70,"sessionId"],[200,75,200,79],[200,79,200,83],[200,81,200,85],[201,12,201,8],[201,16,201,12,"nodeIds"],[201,23,201,19],[201,24,201,20,"length"],[201,30,201,26],[201,33,201,29],[201,34,201,30],[201,38,201,34,"sessionId"],[201,47,201,43],[201,49,201,45],[202,14,202,10],[202,18,202,14],[202,19,202,15,"_handleDsResolve"],[202,35,202,31],[202,36,202,32,"nodeIds"],[202,43,202,39],[202,45,202,41,"sessionId"],[202,54,202,50],[202,55,202,51],[202,56,202,52,"catch"],[202,61,202,57],[202,62,202,58,"err"],[202,65,202,61],[202,69,202,65],[203,16,203,12,"console"],[203,23,203,19],[203,24,203,20,"log"],[203,27,203,23],[203,28,203,24],[203,60,203,56],[203,62,203,58,"err"],[203,65,203,61],[203,66,203,62],[204,14,204,10],[204,15,204,11],[204,16,204,12],[205,12,205,8],[206,12,206,8],[207,10,207,6],[208,8,209,6],[209,10,210,8],[210,6,211,4],[212,6,213,4],[213,6,214,4],[213,10,214,8],[213,11,214,9,"_dispatch"],[213,20,214,18],[213,21,214,19,"type"],[213,25,214,23],[213,27,214,25,"envelope"],[213,35,214,33],[213,36,214,34],[214,4,215,2],[215,4,217,10,"_dispatch"],[215,13,217,19,"_dispatch"],[215,14,217,20,"type"],[215,18,217,39],[215,20,217,41,"envelope"],[215,28,217,61],[215,30,217,69],[216,6,218,4],[216,12,218,10,"handlers"],[216,20,218,18],[216,23,218,21],[216,27,218,25],[216,28,218,26,"handlers"],[216,36,218,34],[216,37,218,35,"get"],[216,40,218,38],[216,41,218,39,"type"],[216,45,218,43],[216,46,218,44],[216,50,218,48],[216,52,218,50],[217,6,219,4],[217,11,219,9],[217,17,219,15,"handler"],[217,24,219,22],[217,28,219,26,"handlers"],[217,36,219,34],[217,38,219,36],[218,8,220,6],[218,12,220,10],[219,10,221,8,"handler"],[219,17,221,15],[219,18,221,16,"envelope"],[219,26,221,24],[219,27,221,25],[220,8,222,6],[220,9,222,7],[220,10,222,8],[220,17,222,15,"err"],[220,20,222,18],[220,22,222,20],[221,10,223,8,"console"],[221,17,223,15],[221,18,223,16,"error"],[221,23,223,21],[221,24,223,22],[221,50,223,48,"type"],[221,54,223,52],[221,57,223,55],[221,59,223,57,"err"],[221,62,223,60],[221,63,223,61],[222,8,224,6],[223,6,225,4],[224,4,226,2],[226,4,228,2],[227,0,229,0],[228,0,230,0],[229,0,231,0],[230,0,232,0],[231,4,233,2],[231,10,233,16,"_handleDsResolve"],[231,26,233,32,"_handleDsResolve"],[231,27,233,33,"nodeIds"],[231,34,233,50],[231,36,233,52,"sessionId"],[231,45,233,69],[231,47,233,86],[232,6,234,4],[232,10,234,8],[233,8,235,6],[233,14,235,12,"userId"],[233,20,235,18],[233,23,235,21],[233,27,235,25],[233,28,235,26,"_userId"],[233,35,235,33],[233,39,235,37],[233,41,235,39],[234,8,236,6],[234,12,236,10],[234,13,236,11,"userId"],[234,19,236,17],[234,21,236,19],[235,8,238,6],[235,14,238,12],[236,10,238,14,"loadPKG"],[237,8,238,22],[237,9,238,23],[237,12,238,26,"require"],[237,19,238,33],[237,20,238,33,"_dependencyMap"],[237,34,238,33],[237,60,238,55],[237,61,238,56],[238,8,239,6],[238,14,239,12],[239,10,239,14,"nodeToText"],[240,8,239,25],[240,9,239,26],[240,12,239,29,"require"],[240,19,239,36],[240,20,239,36,"_dependencyMap"],[240,34,239,36],[240,61,239,59],[240,62,239,60],[241,8,240,6],[241,14,240,12,"pkg"],[241,17,240,15],[241,20,240,18],[241,26,240,24,"loadPKG"],[241,33,240,31],[241,34,240,32,"userId"],[241,40,240,38],[241,41,240,39],[242,8,242,6],[242,14,242,12,"nodes"],[242,19,242,17],[242,22,242,20,"nodeIds"],[242,29,242,27],[242,30,243,9,"filter"],[242,36,243,15],[242,37,243,16,"id"],[242,39,243,18],[242,43,243,22,"pkg"],[242,46,243,25],[242,47,243,26,"nodes"],[242,52,243,31],[242,53,243,32,"id"],[242,55,243,34],[242,56,243,35],[242,57,243,36],[242,58,244,9,"map"],[242,61,244,12],[242,62,244,14,"id"],[242,64,244,24],[242,69,244,30],[243,10,245,10,"id"],[243,12,245,12],[244,10,246,10,"text"],[244,14,246,14],[244,16,246,16,"nodeToText"],[244,26,246,26],[244,27,246,27,"pkg"],[244,30,246,30],[244,31,246,31,"nodes"],[244,36,246,36],[244,37,246,37,"id"],[244,39,246,39],[244,40,246,40],[245,8,247,8],[245,9,247,9],[245,10,247,10],[245,11,247,11],[246,8,249,6],[246,12,249,10],[246,13,249,11,"send"],[246,17,249,15],[246,18,249,16],[246,30,249,28],[246,32,249,30],[247,10,250,8,"session_id"],[247,20,250,18],[247,22,250,20,"sessionId"],[247,31,250,29],[248,10,251,8,"nodes"],[249,8,252,6],[249,9,252,7],[249,10,252,8],[250,8,254,6,"console"],[250,15,254,13],[250,16,254,14,"log"],[250,19,254,17],[250,20,254,18],[250,45,254,43,"nodes"],[250,50,254,48],[250,51,254,49,"length"],[250,57,254,55],[250,74,254,72],[250,75,254,73],[251,6,255,4],[251,7,255,5],[251,8,255,6],[251,15,255,13,"err"],[251,18,255,16],[251,20,255,18],[252,8,256,6,"console"],[252,15,256,13],[252,16,256,14,"log"],[252,19,256,17],[252,20,256,18],[252,52,256,50],[252,54,256,52,"err"],[252,57,256,55],[252,58,256,56],[253,8,257,6],[254,8,258,6],[254,12,258,10],[254,13,258,11,"send"],[254,17,258,15],[254,18,258,16],[254,30,258,28],[254,32,258,30],[255,10,258,32,"session_id"],[255,20,258,42],[255,22,258,44,"sessionId"],[255,31,258,53],[256,10,258,55,"nodes"],[256,15,258,60],[256,17,258,62],[257,8,258,65],[257,9,258,66],[257,10,258,67],[258,6,259,4],[259,4,260,2],[260,4,262,10,"_startHeartbeat"],[260,19,262,25,"_startHeartbeat"],[260,20,262,26,"intervalMs"],[260,30,262,44],[260,32,262,52],[261,6,263,4],[261,10,263,8],[261,11,263,9,"_stopHeartbeat"],[261,25,263,23],[261,26,263,24],[261,27,263,25],[262,6,264,4],[262,10,264,8],[262,11,264,9,"heartbeatSeq"],[262,23,264,21],[262,26,264,24],[262,27,264,25],[263,6,266,4],[263,10,266,8],[263,11,266,9,"heartbeatTimer"],[263,25,266,23],[263,28,266,26,"setInterval"],[263,39,266,37],[263,40,266,38],[263,46,266,44],[264,8,267,6],[264,12,267,10],[264,16,267,14],[264,17,267,15,"ws"],[264,19,267,17],[264,23,267,21],[264,27,267,25],[264,28,267,26,"ws"],[264,30,267,28],[264,31,267,29,"readyState"],[264,41,267,39],[264,46,267,44,"WebSocket"],[264,55,267,53],[264,56,267,54,"OPEN"],[264,60,267,58],[264,64,267,62],[264,68,267,66],[264,69,267,67,"sessionId"],[264,78,267,76],[264,80,267,78],[265,10,268,8],[265,14,268,12],[265,15,268,13,"heartbeatSeq"],[265,27,268,25],[265,29,268,27],[266,10,269,8],[266,14,269,12],[266,15,269,13,"send"],[266,19,269,17],[266,20,269,18],[266,31,269,29],[266,33,269,31],[267,12,270,10,"session_id"],[267,22,270,20],[267,24,270,22],[267,28,270,26],[267,29,270,27,"sessionId"],[267,38,270,36],[268,12,271,10,"seq"],[268,15,271,13],[268,17,271,15],[268,21,271,19],[268,22,271,20,"heartbeatSeq"],[268,34,271,32],[269,12,272,10,"client_ts"],[269,21,272,19],[269,23,272,21],[269,27,272,25,"Date"],[269,31,272,29],[269,32,272,30],[269,33,272,31],[269,34,272,32,"toISOString"],[269,45,272,43],[269,46,272,44],[270,10,273,8],[270,11,273,9],[270,12,273,10],[271,8,274,6],[272,6,275,4],[272,7,275,5],[272,9,275,7,"intervalMs"],[272,19,275,17],[272,20,275,18],[273,6,277,4,"console"],[273,13,277,11],[273,14,277,12,"log"],[273,17,277,15],[273,18,277,16],[273,45,277,43,"intervalMs"],[273,55,277,53],[273,68,277,66],[273,69,277,67],[274,4,278,2],[275,4,280,10,"_stopHeartbeat"],[275,18,280,24,"_stopHeartbeat"],[275,19,280,24],[275,21,280,33],[276,6,281,4],[276,10,281,8],[276,14,281,12],[276,15,281,13,"heartbeatTimer"],[276,29,281,27],[276,31,281,29],[277,8,282,6,"clearInterval"],[277,21,282,19],[277,22,282,20],[277,26,282,24],[277,27,282,25,"heartbeatTimer"],[277,41,282,39],[277,42,282,40],[278,8,283,6],[278,12,283,10],[278,13,283,11,"heartbeatTimer"],[278,27,283,25],[278,30,283,28],[278,34,283,32],[279,6,284,4],[280,4,285,2],[281,4,287,10,"_cleanup"],[281,12,287,18,"_cleanup"],[281,13,287,18],[281,15,287,27],[282,6,288,4],[282,10,288,8],[282,11,288,9,"_stopHeartbeat"],[282,25,288,23],[282,26,288,24],[282,27,288,25],[283,6,289,4],[283,10,289,8],[283,11,289,9,"_isConnected"],[283,23,289,21],[283,26,289,24],[283,31,289,29],[284,6,290,4],[284,10,290,8],[284,11,290,9,"_isAuthenticated"],[284,27,290,25],[284,30,290,28],[284,35,290,33],[285,6,291,4],[285,10,291,8],[285,11,291,9,"sessionId"],[285,20,291,18],[285,23,291,21],[285,27,291,25],[286,6,292,4],[286,10,292,8],[286,11,292,9,"ws"],[286,13,292,11],[286,16,292,14],[286,20,292,18],[287,4,293,2],[288,2,294,0],[290,2,296,0],[291,2,297,7],[291,8,297,13,"wsClient"],[291,16,297,21],[291,19,297,24],[291,23,297,28,"MyndLensWSClient"],[291,39,297,44],[291,40,297,45],[291,41,297,46],[292,0,297,47],[292,3]],"functionMap":{"names":["<global>","MyndLensWSClient","MyndLensWSClient#get__isConnected","MyndLensWSClient#get__isAuthenticated","MyndLensWSClient#get__currentSessionId","MyndLensWSClient#get__userId","MyndLensWSClient#on","<anonymous>","MyndLensWSClient#connect","Promise$argument_0","ws.onopen","ws.onmessage","ws.onclose","ws.onerror","MyndLensWSClient#send","MyndLensWSClient#sendExecuteRequest","MyndLensWSClient#disconnect","MyndLensWSClient#_routeMessage","_handleDsResolve._catch$argument_0","MyndLensWSClient#_dispatch","MyndLensWSClient#_handleDsResolve","nodeIds.filter$argument_0","nodeIds.filter.map$argument_0","MyndLensWSClient#_startHeartbeat","setInterval$argument_0","MyndLensWSClient#_stopHeartbeat","MyndLensWSClient#_cleanup"],"mappings":"AAA;OCgC;ECU,wDD;EEC,gEF;EGC,gEH;EIC,oDJ;EKK;WCK;KDI;GLC;EOK;uBCK;yBCc;SDU;4BEE;SFO;0BGE;SHY;0BIE;SJG;KDK;GPC;EaK;Gbc;EcK;GdM;EeK;GfK;EgBI;0DC6B;WDE;GhBW;EkBE;GlBS;EmBO;gBCU,mBD;aEC;UFG;GnBa;EsBE;sCCI;KDS;GtBG;EwBE;GxBK;EyBE;GzBM;CDC"},"hasCjsExports":false},"type":"js/module"}]}