{"dependencies":[{"name":"../config/env","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":264},"end":{"line":11,"column":36,"index":300}}],"key":"RGB4LNLgNgEtjcVNHbEAgFn5Y3M=","exportNames":["*"],"imports":1}},{"name":"./auth","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":301},"end":{"line":12,"column":61,"index":362}}],"key":"bPsbxvG/upGRzIWg1D65yZCgVZE=","exportNames":["*"],"imports":1}},{"name":"../digital-self/pkg","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":248,"column":26,"index":7869},"end":{"line":248,"column":56,"index":7899}}],"key":"UJmT24Ec+/AxLIkxT2J+TUQ2KkA=","exportNames":["*"],"imports":1,"isOptional":true}},{"name":"../digital-self/sync","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":249,"column":29,"index":7930},"end":{"line":249,"column":60,"index":7961}}],"key":"0xXQyM4XHrm3FcELV8MK3J1z7SQ=","exportNames":["*"],"imports":1,"isOptional":true}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"MyndLensWSClient\", {\n    enumerable: true,\n    get: function () {\n      return MyndLensWSClient;\n    }\n  });\n  Object.defineProperty(exports, \"wsClient\", {\n    enumerable: true,\n    get: function () {\n      return wsClient;\n    }\n  });\n  var _configEnv = require(_dependencyMap[0], \"../config/env\");\n  var _auth = require(_dependencyMap[1], \"./auth\");\n  /**\n   * WebSocket client — connects to MyndLens BE with auth.\n   *\n   * Protocol:\n   * 1. Connect to WS endpoint\n   * 2. Send AUTH message with token + device_id\n   * 3. Receive AUTH_OK with session_id\n   * 4. Start heartbeat loop\n   * 5. Route incoming messages to handlers\n   */\n\n  // Device → Backend: here is the readable text for those nodes\n\n  class MyndLensWSClient {\n    ws = null;\n    sessionId = null;\n    handlers = new Map();\n    heartbeatTimer = null;\n    heartbeatSeq = 0;\n    _isConnected = false;\n    _isAuthenticated = false;\n    _userId = null;\n    // Prevents session_terminated from firing when disconnect() is called\n    // intentionally as part of a connect() → reconnect flow.\n    _suppressNextClose = false;\n    get isConnected() {\n      return this._isConnected;\n    }\n    get isAuthenticated() {\n      return this._isAuthenticated;\n    }\n    get currentSessionId() {\n      return this.sessionId;\n    }\n    get userId() {\n      return this._userId;\n    }\n\n    /**\n     * Register a handler for a specific message type.\n     */\n    on(type, handler) {\n      const existing = this.handlers.get(type) || [];\n      existing.push(handler);\n      this.handlers.set(type, existing);\n      // Return unsubscribe function\n      return () => {\n        const handlers = this.handlers.get(type) || [];\n        const idx = handlers.indexOf(handler);\n        if (idx >= 0) handlers.splice(idx, 1);\n      };\n    }\n\n    /**\n     * Connect to the WebSocket server.\n     */\n    async connect() {\n      if (this.ws) {\n        // Closing the old socket intentionally — suppress the session_terminated\n        // event that onclose would normally dispatch. This close is part of a\n        // controlled reconnect, not an unexpected session loss.\n        this._suppressNextClose = true;\n        this.disconnect();\n      }\n      return new Promise(async (resolve, reject) => {\n        try {\n          const token = await (0, _auth.getStoredToken)();\n          if (!token) {\n            reject(new Error('No auth token available. Pair device first.'));\n            return;\n          }\n          const deviceId = await (0, _auth.getOrCreateDeviceId)();\n          const wsUrl = _configEnv.ENV.WS_URL;\n          console.log('[WS] Connecting to', wsUrl);\n          this.ws = new WebSocket(wsUrl);\n          this.ws.onopen = () => {\n            console.log('[WS] Connected, sending AUTH');\n            this._isConnected = true;\n\n            // Send AUTH message\n            this.send('auth', {\n              token,\n              device_id: deviceId,\n              client_version: '1.0.0'\n            });\n          };\n          this.ws.onmessage = event => {\n            try {\n              const envelope = JSON.parse(event.data);\n              this._routeMessage(envelope, resolve, reject);\n            } catch (err) {\n              console.error('[WS] Failed to parse message:', err);\n            }\n          };\n          this.ws.onclose = event => {\n            console.log('[WS] Closed:', event.code, event.reason);\n            const suppressed = this._suppressNextClose;\n            this._suppressNextClose = false;\n            this._cleanup();\n            // Only notify listeners of an unexpected session loss.\n            // Suppressed = this close was triggered by connect() to clear a stale socket.\n            if (!suppressed) {\n              this._dispatch('session_terminated', {\n                type: 'session_terminated',\n                id: '',\n                timestamp: new Date().toISOString(),\n                payload: {\n                  code: event.code,\n                  reason: event.reason\n                }\n              });\n            }\n          };\n          this.ws.onerror = error => {\n            console.warn('[WS] Connection error (non-fatal):', error?.type || 'unknown');\n            // Don't reject - let onclose handle reconnection\n          };\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n\n    /**\n     * Send a typed message to the server.\n     */\n    send(type, payload = {}) {\n      if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n        console.warn('[WS] Cannot send, not connected');\n        return;\n      }\n      const envelope = {\n        type,\n        id: Math.random().toString(36).substring(2),\n        timestamp: new Date().toISOString(),\n        payload\n      };\n      this.ws.send(JSON.stringify(envelope));\n    }\n\n    /**\n     * Send an execute request (with presence gate on server).\n     */\n    sendExecuteRequest(draftId, touchToken) {\n      this.send('execute_request', {\n        session_id: this.sessionId,\n        draft_id: draftId,\n        touch_token: touchToken || null\n      });\n    }\n\n    /**\n     * Disconnect and cleanup.\n     */\n    disconnect() {\n      if (this.ws) {\n        this.ws.close(1000, 'Client disconnect');\n      }\n      this._cleanup();\n    }\n\n    // ---- Private ----\n\n    _routeMessage(envelope, resolve, reject) {\n      const {\n        type\n      } = envelope;\n      switch (type) {\n        case 'auth_ok':\n          this.sessionId = envelope.payload.session_id;\n          this._userId = envelope.payload.user_id;\n          this._isAuthenticated = true;\n          this._startHeartbeat(envelope.payload.heartbeat_interval_ms || _configEnv.ENV.HEARTBEAT_INTERVAL_MS);\n          console.log('[WS] Authenticated, session:', this.sessionId);\n          resolve?.();\n          break;\n        case 'auth_fail':\n          console.error('[WS] Auth failed:', envelope.payload.reason);\n          this._isAuthenticated = false;\n          reject?.(new Error(envelope.payload.reason));\n          break;\n        case 'heartbeat_ack':\n          // Heartbeat acknowledged — no action needed\n          break;\n        case 'ds_resolve':\n          {\n            // Backend matched vector nodes and needs us to provide the readable text.\n            // Look up node IDs in local PKG, send back { nodes: [{id, text}] }.\n            const nodeIds = envelope.payload.node_ids ?? [];\n            const sessionId = envelope.payload.session_id ?? this.sessionId ?? '';\n            if (nodeIds.length > 0 && sessionId) {\n              this._handleDsResolve(nodeIds, sessionId).catch(err => {\n                console.log('[WS] ds_resolve handler error:', err);\n              });\n            }\n            break;\n          }\n        default:\n          break;\n      }\n\n      // Dispatch to registered handlers\n      this._dispatch(type, envelope);\n    }\n    _dispatch(type, envelope) {\n      const handlers = this.handlers.get(type) || [];\n      for (const handler of handlers) {\n        try {\n          handler(envelope);\n        } catch (err) {\n          console.error(`[WS] Handler error for ${type}:`, err);\n        }\n      }\n    }\n\n    /**\n     * Handle ds_resolve: backend matched vector node IDs and needs readable text.\n     * Look up each node_id in the local PKG, return the text-only representation.\n     * Responds immediately with ds_context — keeps pipeline latency minimal.\n     */\n    async _handleDsResolve(nodeIds, sessionId) {\n      try {\n        const userId = this._userId ?? '';\n        if (!userId) return;\n        const {\n          loadPKG\n        } = require(_dependencyMap[2], \"../digital-self/pkg\");\n        const {\n          nodeToText\n        } = require(_dependencyMap[3], \"../digital-self/sync\");\n        const pkg = await loadPKG(userId);\n        const nodes = nodeIds.filter(id => pkg.nodes[id]).map(id => ({\n          id,\n          text: nodeToText(pkg.nodes[id])\n        }));\n        this.send('ds_context', {\n          session_id: sessionId,\n          nodes\n        });\n        console.log(`[WS] ds_context sent: ${nodes.length} nodes resolved`);\n      } catch (err) {\n        console.log('[WS] ds_resolve lookup failed:', err);\n        // Send empty ds_context so backend doesn't time out waiting\n        this.send('ds_context', {\n          session_id: sessionId,\n          nodes: []\n        });\n      }\n    }\n    _startHeartbeat(intervalMs) {\n      this._stopHeartbeat();\n      this.heartbeatSeq = 0;\n      this.heartbeatTimer = setInterval(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN && this.sessionId) {\n          this.heartbeatSeq++;\n          this.send('heartbeat', {\n            session_id: this.sessionId,\n            seq: this.heartbeatSeq,\n            client_ts: new Date().toISOString()\n          });\n        }\n      }, intervalMs);\n      console.log(`[WS] Heartbeat started: ${intervalMs}ms interval`);\n    }\n    _stopHeartbeat() {\n      if (this.heartbeatTimer) {\n        clearInterval(this.heartbeatTimer);\n        this.heartbeatTimer = null;\n      }\n    }\n    _cleanup() {\n      this._stopHeartbeat();\n      this._isConnected = false;\n      this._isAuthenticated = false;\n      this.sessionId = null;\n      this.ws = null;\n    }\n  }\n\n  // Singleton instance\n  const wsClient = new MyndLensWSClient();\n});","lineCount":302,"map":[[7,2,33,0,"Object"],[7,8,33,0],[7,9,33,0,"defineProperty"],[7,23,33,0],[7,24,33,0,"exports"],[7,31,33,0],[8,4,33,0,"enumerable"],[8,14,33,0],[9,4,33,0,"get"],[9,7,33,0],[9,18,33,0,"get"],[9,19,33,0],[10,6,33,0],[10,13,33,0,"MyndLensWSClient"],[10,29,33,0],[11,4,33,0],[12,2,33,0],[13,2,307,0,"Object"],[13,8,307,0],[13,9,307,0,"defineProperty"],[13,23,307,0],[13,24,307,0,"exports"],[13,31,307,0],[14,4,307,0,"enumerable"],[14,14,307,0],[15,4,307,0,"get"],[15,7,307,0],[15,18,307,0,"get"],[15,19,307,0],[16,6,307,0],[16,13,307,0,"wsClient"],[16,21,307,0],[17,4,307,0],[18,2,307,0],[19,2,11,0],[19,6,11,0,"_configEnv"],[19,16,11,0],[19,19,11,0,"require"],[19,26,11,0],[19,27,11,0,"_dependencyMap"],[19,41,11,0],[20,2,12,0],[20,6,12,0,"_auth"],[20,11,12,0],[20,14,12,0,"require"],[20,21,12,0],[20,22,12,0,"_dependencyMap"],[20,36,12,0],[21,2,1,0],[22,0,2,0],[23,0,3,0],[24,0,4,0],[25,0,5,0],[26,0,6,0],[27,0,7,0],[28,0,8,0],[29,0,9,0],[30,0,10,0],[32,2,22,20],[34,2,33,7],[34,8,33,13,"MyndLensWSClient"],[34,24,33,29],[34,25,33,30],[35,4,34,10,"ws"],[35,6,34,12],[35,9,34,33],[35,13,34,37],[36,4,35,10,"sessionId"],[36,13,35,19],[36,16,35,37],[36,20,35,41],[37,4,36,10,"handlers"],[37,12,36,18],[37,15,36,61],[37,19,36,65,"Map"],[37,22,36,68],[37,23,36,69],[37,24,36,70],[38,4,37,10,"heartbeatTimer"],[38,18,37,24],[38,21,37,66],[38,25,37,70],[39,4,38,10,"heartbeatSeq"],[39,16,38,22],[39,19,38,33],[39,20,38,34],[40,4,39,10,"_isConnected"],[40,16,39,22],[40,19,39,34],[40,24,39,39],[41,4,40,10,"_isAuthenticated"],[41,20,40,26],[41,23,40,38],[41,28,40,43],[42,4,41,10,"_userId"],[42,11,41,17],[42,14,41,35],[42,18,41,39],[43,4,42,2],[44,4,43,2],[45,4,44,10,"_suppressNextClose"],[45,22,44,28],[45,25,44,40],[45,30,44,45],[46,4,46,2],[46,8,46,6,"isConnected"],[46,19,46,17,"isConnected"],[46,20,46,17],[46,22,46,29],[47,6,46,31],[47,13,46,38],[47,17,46,42],[47,18,46,43,"_isConnected"],[47,30,46,55],[48,4,46,57],[49,4,47,2],[49,8,47,6,"isAuthenticated"],[49,23,47,21,"isAuthenticated"],[49,24,47,21],[49,26,47,33],[50,6,47,35],[50,13,47,42],[50,17,47,46],[50,18,47,47,"_isAuthenticated"],[50,34,47,63],[51,4,47,65],[52,4,48,2],[52,8,48,6,"currentSessionId"],[52,24,48,22,"currentSessionId"],[52,25,48,22],[52,27,48,40],[53,6,48,42],[53,13,48,49],[53,17,48,53],[53,18,48,54,"sessionId"],[53,27,48,63],[54,4,48,65],[55,4,49,2],[55,8,49,6,"userId"],[55,14,49,12,"userId"],[55,15,49,12],[55,17,49,30],[56,6,49,32],[56,13,49,39],[56,17,49,43],[56,18,49,44,"_userId"],[56,25,49,51],[57,4,49,53],[59,4,51,2],[60,0,52,0],[61,0,53,0],[62,4,54,2,"on"],[62,6,54,4,"on"],[62,7,54,5,"type"],[62,11,54,24],[62,13,54,26,"handler"],[62,20,54,51],[62,22,54,65],[63,6,55,4],[63,12,55,10,"existing"],[63,20,55,18],[63,23,55,21],[63,27,55,25],[63,28,55,26,"handlers"],[63,36,55,34],[63,37,55,35,"get"],[63,40,55,38],[63,41,55,39,"type"],[63,45,55,43],[63,46,55,44],[63,50,55,48],[63,52,55,50],[64,6,56,4,"existing"],[64,14,56,12],[64,15,56,13,"push"],[64,19,56,17],[64,20,56,18,"handler"],[64,27,56,25],[64,28,56,26],[65,6,57,4],[65,10,57,8],[65,11,57,9,"handlers"],[65,19,57,17],[65,20,57,18,"set"],[65,23,57,21],[65,24,57,22,"type"],[65,28,57,26],[65,30,57,28,"existing"],[65,38,57,36],[65,39,57,37],[66,6,58,4],[67,6,59,4],[67,13,59,11],[67,19,59,17],[68,8,60,6],[68,14,60,12,"handlers"],[68,22,60,20],[68,25,60,23],[68,29,60,27],[68,30,60,28,"handlers"],[68,38,60,36],[68,39,60,37,"get"],[68,42,60,40],[68,43,60,41,"type"],[68,47,60,45],[68,48,60,46],[68,52,60,50],[68,54,60,52],[69,8,61,6],[69,14,61,12,"idx"],[69,17,61,15],[69,20,61,18,"handlers"],[69,28,61,26],[69,29,61,27,"indexOf"],[69,36,61,34],[69,37,61,35,"handler"],[69,44,61,42],[69,45,61,43],[70,8,62,6],[70,12,62,10,"idx"],[70,15,62,13],[70,19,62,17],[70,20,62,18],[70,22,62,20,"handlers"],[70,30,62,28],[70,31,62,29,"splice"],[70,37,62,35],[70,38,62,36,"idx"],[70,41,62,39],[70,43,62,41],[70,44,62,42],[70,45,62,43],[71,6,63,4],[71,7,63,5],[72,4,64,2],[74,4,66,2],[75,0,67,0],[76,0,68,0],[77,4,69,2],[77,10,69,8,"connect"],[77,17,69,15,"connect"],[77,18,69,15],[77,20,69,33],[78,6,70,4],[78,10,70,8],[78,14,70,12],[78,15,70,13,"ws"],[78,17,70,15],[78,19,70,17],[79,8,71,6],[80,8,72,6],[81,8,73,6],[82,8,74,6],[82,12,74,10],[82,13,74,11,"_suppressNextClose"],[82,31,74,29],[82,34,74,32],[82,38,74,36],[83,8,75,6],[83,12,75,10],[83,13,75,11,"disconnect"],[83,23,75,21],[83,24,75,22],[83,25,75,23],[84,6,76,4],[85,6,78,4],[85,13,78,11],[85,17,78,15,"Promise"],[85,24,78,22],[85,25,78,23],[85,32,78,30,"resolve"],[85,39,78,37],[85,41,78,39,"reject"],[85,47,78,45],[85,52,78,50],[86,8,79,6],[86,12,79,10],[87,10,80,8],[87,16,80,14,"token"],[87,21,80,19],[87,24,80,22],[87,30,80,28],[87,34,80,28,"getStoredToken"],[87,39,80,42],[87,40,80,42,"getStoredToken"],[87,54,80,42],[87,56,80,43],[87,57,80,44],[88,10,81,8],[88,14,81,12],[88,15,81,13,"token"],[88,20,81,18],[88,22,81,20],[89,12,82,10,"reject"],[89,18,82,16],[89,19,82,17],[89,23,82,21,"Error"],[89,28,82,26],[89,29,82,27],[89,74,82,72],[89,75,82,73],[89,76,82,74],[90,12,83,10],[91,10,84,8],[92,10,86,8],[92,16,86,14,"deviceId"],[92,24,86,22],[92,27,86,25],[92,33,86,31],[92,37,86,31,"getOrCreateDeviceId"],[92,42,86,50],[92,43,86,50,"getOrCreateDeviceId"],[92,62,86,50],[92,64,86,51],[92,65,86,52],[93,10,87,8],[93,16,87,14,"wsUrl"],[93,21,87,19],[93,24,87,22,"ENV"],[93,34,87,25],[93,35,87,25,"ENV"],[93,38,87,25],[93,39,87,26,"WS_URL"],[93,45,87,32],[94,10,89,8,"console"],[94,17,89,15],[94,18,89,16,"log"],[94,21,89,19],[94,22,89,20],[94,42,89,40],[94,44,89,42,"wsUrl"],[94,49,89,47],[94,50,89,48],[95,10,90,8],[95,14,90,12],[95,15,90,13,"ws"],[95,17,90,15],[95,20,90,18],[95,24,90,22,"WebSocket"],[95,33,90,31],[95,34,90,32,"wsUrl"],[95,39,90,37],[95,40,90,38],[96,10,92,8],[96,14,92,12],[96,15,92,13,"ws"],[96,17,92,15],[96,18,92,16,"onopen"],[96,24,92,22],[96,27,92,25],[96,33,92,31],[97,12,93,10,"console"],[97,19,93,17],[97,20,93,18,"log"],[97,23,93,21],[97,24,93,22],[97,54,93,52],[97,55,93,53],[98,12,94,10],[98,16,94,14],[98,17,94,15,"_isConnected"],[98,29,94,27],[98,32,94,30],[98,36,94,34],[100,12,96,10],[101,12,97,10],[101,16,97,14],[101,17,97,15,"send"],[101,21,97,19],[101,22,97,20],[101,28,97,26],[101,30,97,28],[102,14,98,12,"token"],[102,19,98,17],[103,14,99,12,"device_id"],[103,23,99,21],[103,25,99,23,"deviceId"],[103,33,99,31],[104,14,100,12,"client_version"],[104,28,100,26],[104,30,100,28],[105,12,101,10],[105,13,101,11],[105,14,101,12],[106,10,102,8],[106,11,102,9],[107,10,104,8],[107,14,104,12],[107,15,104,13,"ws"],[107,17,104,15],[107,18,104,16,"onmessage"],[107,27,104,25],[107,30,104,29,"event"],[107,35,104,34],[107,39,104,39],[108,12,105,10],[108,16,105,14],[109,14,106,12],[109,20,106,18,"envelope"],[109,28,106,38],[109,31,106,41,"JSON"],[109,35,106,45],[109,36,106,46,"parse"],[109,41,106,51],[109,42,106,52,"event"],[109,47,106,57],[109,48,106,58,"data"],[109,52,106,62],[109,53,106,63],[110,14,107,12],[110,18,107,16],[110,19,107,17,"_routeMessage"],[110,32,107,30],[110,33,107,31,"envelope"],[110,41,107,39],[110,43,107,41,"resolve"],[110,50,107,48],[110,52,107,50,"reject"],[110,58,107,56],[110,59,107,57],[111,12,108,10],[111,13,108,11],[111,14,108,12],[111,21,108,19,"err"],[111,24,108,22],[111,26,108,24],[112,14,109,12,"console"],[112,21,109,19],[112,22,109,20,"error"],[112,27,109,25],[112,28,109,26],[112,59,109,57],[112,61,109,59,"err"],[112,64,109,62],[112,65,109,63],[113,12,110,10],[114,10,111,8],[114,11,111,9],[115,10,113,8],[115,14,113,12],[115,15,113,13,"ws"],[115,17,113,15],[115,18,113,16,"onclose"],[115,25,113,23],[115,28,113,27,"event"],[115,33,113,32],[115,37,113,37],[116,12,114,10,"console"],[116,19,114,17],[116,20,114,18,"log"],[116,23,114,21],[116,24,114,22],[116,38,114,36],[116,40,114,38,"event"],[116,45,114,43],[116,46,114,44,"code"],[116,50,114,48],[116,52,114,50,"event"],[116,57,114,55],[116,58,114,56,"reason"],[116,64,114,62],[116,65,114,63],[117,12,115,10],[117,18,115,16,"suppressed"],[117,28,115,26],[117,31,115,29],[117,35,115,33],[117,36,115,34,"_suppressNextClose"],[117,54,115,52],[118,12,116,10],[118,16,116,14],[118,17,116,15,"_suppressNextClose"],[118,35,116,33],[118,38,116,36],[118,43,116,41],[119,12,117,10],[119,16,117,14],[119,17,117,15,"_cleanup"],[119,25,117,23],[119,26,117,24],[119,27,117,25],[120,12,118,10],[121,12,119,10],[122,12,120,10],[122,16,120,14],[122,17,120,15,"suppressed"],[122,27,120,25],[122,29,120,27],[123,14,121,12],[123,18,121,16],[123,19,121,17,"_dispatch"],[123,28,121,26],[123,29,121,27],[123,49,121,47],[123,51,121,49],[124,16,122,14,"type"],[124,20,122,18],[124,22,122,20],[124,42,122,40],[125,16,123,14,"id"],[125,18,123,16],[125,20,123,18],[125,22,123,20],[126,16,124,14,"timestamp"],[126,25,124,23],[126,27,124,25],[126,31,124,29,"Date"],[126,35,124,33],[126,36,124,34],[126,37,124,35],[126,38,124,36,"toISOString"],[126,49,124,47],[126,50,124,48],[126,51,124,49],[127,16,125,14,"payload"],[127,23,125,21],[127,25,125,23],[128,18,125,25,"code"],[128,22,125,29],[128,24,125,31,"event"],[128,29,125,36],[128,30,125,37,"code"],[128,34,125,41],[129,18,125,43,"reason"],[129,24,125,49],[129,26,125,51,"event"],[129,31,125,56],[129,32,125,57,"reason"],[130,16,125,64],[131,14,126,12],[131,15,126,13],[131,16,126,14],[132,12,127,10],[133,10,128,8],[133,11,128,9],[134,10,130,8],[134,14,130,12],[134,15,130,13,"ws"],[134,17,130,15],[134,18,130,16,"onerror"],[134,25,130,23],[134,28,130,27,"error"],[134,33,130,32],[134,37,130,37],[135,12,131,10,"console"],[135,19,131,17],[135,20,131,18,"warn"],[135,24,131,22],[135,25,131,23],[135,61,131,59],[135,63,131,61,"error"],[135,68,131,66],[135,70,131,68,"type"],[135,74,131,72],[135,78,131,76],[135,87,131,85],[135,88,131,86],[136,12,132,10],[137,10,133,8],[137,11,133,9],[138,8,135,6],[138,9,135,7],[138,10,135,8],[138,17,135,15,"err"],[138,20,135,18],[138,22,135,20],[139,10,136,8,"reject"],[139,16,136,14],[139,17,136,15,"err"],[139,20,136,18],[139,21,136,19],[140,8,137,6],[141,6,138,4],[141,7,138,5],[141,8,138,6],[142,4,139,2],[144,4,141,2],[145,0,142,0],[146,0,143,0],[147,4,144,2,"send"],[147,8,144,6,"send"],[147,9,144,7,"type"],[147,13,144,26],[147,15,144,28,"payload"],[147,22,144,56],[147,25,144,59],[147,26,144,60],[147,27,144,61],[147,29,144,69],[148,6,145,4],[148,10,145,8],[148,11,145,9],[148,15,145,13],[148,16,145,14,"ws"],[148,18,145,16],[148,22,145,20],[148,26,145,24],[148,27,145,25,"ws"],[148,29,145,27],[148,30,145,28,"readyState"],[148,40,145,38],[148,45,145,43,"WebSocket"],[148,54,145,52],[148,55,145,53,"OPEN"],[148,59,145,57],[148,61,145,59],[149,8,146,6,"console"],[149,15,146,13],[149,16,146,14,"warn"],[149,20,146,18],[149,21,146,19],[149,54,146,52],[149,55,146,53],[150,8,147,6],[151,6,148,4],[152,6,150,4],[152,12,150,10,"envelope"],[152,20,150,30],[152,23,150,33],[153,8,151,6,"type"],[153,12,151,10],[154,8,152,6,"id"],[154,10,152,8],[154,12,152,10,"Math"],[154,16,152,14],[154,17,152,15,"random"],[154,23,152,21],[154,24,152,22],[154,25,152,23],[154,26,152,24,"toString"],[154,34,152,32],[154,35,152,33],[154,37,152,35],[154,38,152,36],[154,39,152,37,"substring"],[154,48,152,46],[154,49,152,47],[154,50,152,48],[154,51,152,49],[155,8,153,6,"timestamp"],[155,17,153,15],[155,19,153,17],[155,23,153,21,"Date"],[155,27,153,25],[155,28,153,26],[155,29,153,27],[155,30,153,28,"toISOString"],[155,41,153,39],[155,42,153,40],[155,43,153,41],[156,8,154,6,"payload"],[157,6,155,4],[157,7,155,5],[158,6,157,4],[158,10,157,8],[158,11,157,9,"ws"],[158,13,157,11],[158,14,157,12,"send"],[158,18,157,16],[158,19,157,17,"JSON"],[158,23,157,21],[158,24,157,22,"stringify"],[158,33,157,31],[158,34,157,32,"envelope"],[158,42,157,40],[158,43,157,41],[158,44,157,42],[159,4,158,2],[161,4,160,2],[162,0,161,0],[163,0,162,0],[164,4,163,2,"sendExecuteRequest"],[164,22,163,20,"sendExecuteRequest"],[164,23,163,21,"draftId"],[164,30,163,36],[164,32,163,38,"touchToken"],[164,42,163,57],[164,44,163,65],[165,6,164,4],[165,10,164,8],[165,11,164,9,"send"],[165,15,164,13],[165,16,164,14],[165,33,164,31],[165,35,164,33],[166,8,165,6,"session_id"],[166,18,165,16],[166,20,165,18],[166,24,165,22],[166,25,165,23,"sessionId"],[166,34,165,32],[167,8,166,6,"draft_id"],[167,16,166,14],[167,18,166,16,"draftId"],[167,25,166,23],[168,8,167,6,"touch_token"],[168,19,167,17],[168,21,167,19,"touchToken"],[168,31,167,29],[168,35,167,33],[169,6,168,4],[169,7,168,5],[169,8,168,6],[170,4,169,2],[172,4,171,2],[173,0,172,0],[174,0,173,0],[175,4,174,2,"disconnect"],[175,14,174,12,"disconnect"],[175,15,174,12],[175,17,174,21],[176,6,175,4],[176,10,175,8],[176,14,175,12],[176,15,175,13,"ws"],[176,17,175,15],[176,19,175,17],[177,8,176,6],[177,12,176,10],[177,13,176,11,"ws"],[177,15,176,13],[177,16,176,14,"close"],[177,21,176,19],[177,22,176,20],[177,26,176,24],[177,28,176,26],[177,47,176,45],[177,48,176,46],[178,6,177,4],[179,6,178,4],[179,10,178,8],[179,11,178,9,"_cleanup"],[179,19,178,17],[179,20,178,18],[179,21,178,19],[180,4,179,2],[182,4,181,2],[184,4,183,10,"_routeMessage"],[184,17,183,23,"_routeMessage"],[184,18,183,24,"envelope"],[184,26,183,44],[184,28,183,46,"resolve"],[184,35,183,64],[184,37,183,66,"reject"],[184,43,183,83],[184,45,183,91],[185,6,184,4],[185,12,184,10],[186,8,184,12,"type"],[187,6,184,17],[187,7,184,18],[187,10,184,21,"envelope"],[187,18,184,29],[188,6,186,4],[188,14,186,12,"type"],[188,18,186,16],[189,8,187,6],[189,13,187,11],[189,22,187,20],[190,10,188,8],[190,14,188,12],[190,15,188,13,"sessionId"],[190,24,188,22],[190,27,188,25,"envelope"],[190,35,188,33],[190,36,188,34,"payload"],[190,43,188,41],[190,44,188,42,"session_id"],[190,54,188,52],[191,10,189,8],[191,14,189,12],[191,15,189,13,"_userId"],[191,22,189,20],[191,25,189,23,"envelope"],[191,33,189,31],[191,34,189,32,"payload"],[191,41,189,39],[191,42,189,40,"user_id"],[191,49,189,47],[192,10,190,8],[192,14,190,12],[192,15,190,13,"_isAuthenticated"],[192,31,190,29],[192,34,190,32],[192,38,190,36],[193,10,191,8],[193,14,191,12],[193,15,191,13,"_startHeartbeat"],[193,30,191,28],[193,31,191,29,"envelope"],[193,39,191,37],[193,40,191,38,"payload"],[193,47,191,45],[193,48,191,46,"heartbeat_interval_ms"],[193,69,191,67],[193,73,191,71,"ENV"],[193,83,191,74],[193,84,191,74,"ENV"],[193,87,191,74],[193,88,191,75,"HEARTBEAT_INTERVAL_MS"],[193,109,191,96],[193,110,191,97],[194,10,192,8,"console"],[194,17,192,15],[194,18,192,16,"log"],[194,21,192,19],[194,22,192,20],[194,52,192,50],[194,54,192,52],[194,58,192,56],[194,59,192,57,"sessionId"],[194,68,192,66],[194,69,192,67],[195,10,193,8,"resolve"],[195,17,193,15],[195,20,193,18],[195,21,193,19],[196,10,194,8],[197,8,196,6],[197,13,196,11],[197,24,196,22],[198,10,197,8,"console"],[198,17,197,15],[198,18,197,16,"error"],[198,23,197,21],[198,24,197,22],[198,43,197,41],[198,45,197,43,"envelope"],[198,53,197,51],[198,54,197,52,"payload"],[198,61,197,59],[198,62,197,60,"reason"],[198,68,197,66],[198,69,197,67],[199,10,198,8],[199,14,198,12],[199,15,198,13,"_isAuthenticated"],[199,31,198,29],[199,34,198,32],[199,39,198,37],[200,10,199,8,"reject"],[200,16,199,14],[200,19,199,17],[200,23,199,21,"Error"],[200,28,199,26],[200,29,199,27,"envelope"],[200,37,199,35],[200,38,199,36,"payload"],[200,45,199,43],[200,46,199,44,"reason"],[200,52,199,50],[200,53,199,51],[200,54,199,52],[201,10,200,8],[202,8,202,6],[202,13,202,11],[202,28,202,26],[203,10,203,8],[204,10,204,8],[205,8,206,6],[205,13,206,11],[205,25,206,23],[206,10,206,25],[207,12,207,8],[208,12,208,8],[209,12,209,8],[209,18,209,14,"nodeIds"],[209,25,209,31],[209,28,209,34,"envelope"],[209,36,209,42],[209,37,209,43,"payload"],[209,44,209,50],[209,45,209,51,"node_ids"],[209,53,209,59],[209,57,209,63],[209,59,209,65],[210,12,210,8],[210,18,210,14,"sessionId"],[210,27,210,31],[210,30,210,34,"envelope"],[210,38,210,42],[210,39,210,43,"payload"],[210,46,210,50],[210,47,210,51,"session_id"],[210,57,210,61],[210,61,210,65],[210,65,210,69],[210,66,210,70,"sessionId"],[210,75,210,79],[210,79,210,83],[210,81,210,85],[211,12,211,8],[211,16,211,12,"nodeIds"],[211,23,211,19],[211,24,211,20,"length"],[211,30,211,26],[211,33,211,29],[211,34,211,30],[211,38,211,34,"sessionId"],[211,47,211,43],[211,49,211,45],[212,14,212,10],[212,18,212,14],[212,19,212,15,"_handleDsResolve"],[212,35,212,31],[212,36,212,32,"nodeIds"],[212,43,212,39],[212,45,212,41,"sessionId"],[212,54,212,50],[212,55,212,51],[212,56,212,52,"catch"],[212,61,212,57],[212,62,212,58,"err"],[212,65,212,61],[212,69,212,65],[213,16,213,12,"console"],[213,23,213,19],[213,24,213,20,"log"],[213,27,213,23],[213,28,213,24],[213,60,213,56],[213,62,213,58,"err"],[213,65,213,61],[213,66,213,62],[214,14,214,10],[214,15,214,11],[214,16,214,12],[215,12,215,8],[216,12,216,8],[217,10,217,6],[218,8,219,6],[219,10,220,8],[220,6,221,4],[222,6,223,4],[223,6,224,4],[223,10,224,8],[223,11,224,9,"_dispatch"],[223,20,224,18],[223,21,224,19,"type"],[223,25,224,23],[223,27,224,25,"envelope"],[223,35,224,33],[223,36,224,34],[224,4,225,2],[225,4,227,10,"_dispatch"],[225,13,227,19,"_dispatch"],[225,14,227,20,"type"],[225,18,227,39],[225,20,227,41,"envelope"],[225,28,227,61],[225,30,227,69],[226,6,228,4],[226,12,228,10,"handlers"],[226,20,228,18],[226,23,228,21],[226,27,228,25],[226,28,228,26,"handlers"],[226,36,228,34],[226,37,228,35,"get"],[226,40,228,38],[226,41,228,39,"type"],[226,45,228,43],[226,46,228,44],[226,50,228,48],[226,52,228,50],[227,6,229,4],[227,11,229,9],[227,17,229,15,"handler"],[227,24,229,22],[227,28,229,26,"handlers"],[227,36,229,34],[227,38,229,36],[228,8,230,6],[228,12,230,10],[229,10,231,8,"handler"],[229,17,231,15],[229,18,231,16,"envelope"],[229,26,231,24],[229,27,231,25],[230,8,232,6],[230,9,232,7],[230,10,232,8],[230,17,232,15,"err"],[230,20,232,18],[230,22,232,20],[231,10,233,8,"console"],[231,17,233,15],[231,18,233,16,"error"],[231,23,233,21],[231,24,233,22],[231,50,233,48,"type"],[231,54,233,52],[231,57,233,55],[231,59,233,57,"err"],[231,62,233,60],[231,63,233,61],[232,8,234,6],[233,6,235,4],[234,4,236,2],[236,4,238,2],[237,0,239,0],[238,0,240,0],[239,0,241,0],[240,0,242,0],[241,4,243,2],[241,10,243,16,"_handleDsResolve"],[241,26,243,32,"_handleDsResolve"],[241,27,243,33,"nodeIds"],[241,34,243,50],[241,36,243,52,"sessionId"],[241,45,243,69],[241,47,243,86],[242,6,244,4],[242,10,244,8],[243,8,245,6],[243,14,245,12,"userId"],[243,20,245,18],[243,23,245,21],[243,27,245,25],[243,28,245,26,"_userId"],[243,35,245,33],[243,39,245,37],[243,41,245,39],[244,8,246,6],[244,12,246,10],[244,13,246,11,"userId"],[244,19,246,17],[244,21,246,19],[245,8,248,6],[245,14,248,12],[246,10,248,14,"loadPKG"],[247,8,248,22],[247,9,248,23],[247,12,248,26,"require"],[247,19,248,33],[247,20,248,33,"_dependencyMap"],[247,34,248,33],[247,60,248,55],[247,61,248,56],[248,8,249,6],[248,14,249,12],[249,10,249,14,"nodeToText"],[250,8,249,25],[250,9,249,26],[250,12,249,29,"require"],[250,19,249,36],[250,20,249,36,"_dependencyMap"],[250,34,249,36],[250,61,249,59],[250,62,249,60],[251,8,250,6],[251,14,250,12,"pkg"],[251,17,250,15],[251,20,250,18],[251,26,250,24,"loadPKG"],[251,33,250,31],[251,34,250,32,"userId"],[251,40,250,38],[251,41,250,39],[252,8,252,6],[252,14,252,12,"nodes"],[252,19,252,17],[252,22,252,20,"nodeIds"],[252,29,252,27],[252,30,253,9,"filter"],[252,36,253,15],[252,37,253,16,"id"],[252,39,253,18],[252,43,253,22,"pkg"],[252,46,253,25],[252,47,253,26,"nodes"],[252,52,253,31],[252,53,253,32,"id"],[252,55,253,34],[252,56,253,35],[252,57,253,36],[252,58,254,9,"map"],[252,61,254,12],[252,62,254,14,"id"],[252,64,254,24],[252,69,254,30],[253,10,255,10,"id"],[253,12,255,12],[254,10,256,10,"text"],[254,14,256,14],[254,16,256,16,"nodeToText"],[254,26,256,26],[254,27,256,27,"pkg"],[254,30,256,30],[254,31,256,31,"nodes"],[254,36,256,36],[254,37,256,37,"id"],[254,39,256,39],[254,40,256,40],[255,8,257,8],[255,9,257,9],[255,10,257,10],[255,11,257,11],[256,8,259,6],[256,12,259,10],[256,13,259,11,"send"],[256,17,259,15],[256,18,259,16],[256,30,259,28],[256,32,259,30],[257,10,260,8,"session_id"],[257,20,260,18],[257,22,260,20,"sessionId"],[257,31,260,29],[258,10,261,8,"nodes"],[259,8,262,6],[259,9,262,7],[259,10,262,8],[260,8,264,6,"console"],[260,15,264,13],[260,16,264,14,"log"],[260,19,264,17],[260,20,264,18],[260,45,264,43,"nodes"],[260,50,264,48],[260,51,264,49,"length"],[260,57,264,55],[260,74,264,72],[260,75,264,73],[261,6,265,4],[261,7,265,5],[261,8,265,6],[261,15,265,13,"err"],[261,18,265,16],[261,20,265,18],[262,8,266,6,"console"],[262,15,266,13],[262,16,266,14,"log"],[262,19,266,17],[262,20,266,18],[262,52,266,50],[262,54,266,52,"err"],[262,57,266,55],[262,58,266,56],[263,8,267,6],[264,8,268,6],[264,12,268,10],[264,13,268,11,"send"],[264,17,268,15],[264,18,268,16],[264,30,268,28],[264,32,268,30],[265,10,268,32,"session_id"],[265,20,268,42],[265,22,268,44,"sessionId"],[265,31,268,53],[266,10,268,55,"nodes"],[266,15,268,60],[266,17,268,62],[267,8,268,65],[267,9,268,66],[267,10,268,67],[268,6,269,4],[269,4,270,2],[270,4,272,10,"_startHeartbeat"],[270,19,272,25,"_startHeartbeat"],[270,20,272,26,"intervalMs"],[270,30,272,44],[270,32,272,52],[271,6,273,4],[271,10,273,8],[271,11,273,9,"_stopHeartbeat"],[271,25,273,23],[271,26,273,24],[271,27,273,25],[272,6,274,4],[272,10,274,8],[272,11,274,9,"heartbeatSeq"],[272,23,274,21],[272,26,274,24],[272,27,274,25],[273,6,276,4],[273,10,276,8],[273,11,276,9,"heartbeatTimer"],[273,25,276,23],[273,28,276,26,"setInterval"],[273,39,276,37],[273,40,276,38],[273,46,276,44],[274,8,277,6],[274,12,277,10],[274,16,277,14],[274,17,277,15,"ws"],[274,19,277,17],[274,23,277,21],[274,27,277,25],[274,28,277,26,"ws"],[274,30,277,28],[274,31,277,29,"readyState"],[274,41,277,39],[274,46,277,44,"WebSocket"],[274,55,277,53],[274,56,277,54,"OPEN"],[274,60,277,58],[274,64,277,62],[274,68,277,66],[274,69,277,67,"sessionId"],[274,78,277,76],[274,80,277,78],[275,10,278,8],[275,14,278,12],[275,15,278,13,"heartbeatSeq"],[275,27,278,25],[275,29,278,27],[276,10,279,8],[276,14,279,12],[276,15,279,13,"send"],[276,19,279,17],[276,20,279,18],[276,31,279,29],[276,33,279,31],[277,12,280,10,"session_id"],[277,22,280,20],[277,24,280,22],[277,28,280,26],[277,29,280,27,"sessionId"],[277,38,280,36],[278,12,281,10,"seq"],[278,15,281,13],[278,17,281,15],[278,21,281,19],[278,22,281,20,"heartbeatSeq"],[278,34,281,32],[279,12,282,10,"client_ts"],[279,21,282,19],[279,23,282,21],[279,27,282,25,"Date"],[279,31,282,29],[279,32,282,30],[279,33,282,31],[279,34,282,32,"toISOString"],[279,45,282,43],[279,46,282,44],[280,10,283,8],[280,11,283,9],[280,12,283,10],[281,8,284,6],[282,6,285,4],[282,7,285,5],[282,9,285,7,"intervalMs"],[282,19,285,17],[282,20,285,18],[283,6,287,4,"console"],[283,13,287,11],[283,14,287,12,"log"],[283,17,287,15],[283,18,287,16],[283,45,287,43,"intervalMs"],[283,55,287,53],[283,68,287,66],[283,69,287,67],[284,4,288,2],[285,4,290,10,"_stopHeartbeat"],[285,18,290,24,"_stopHeartbeat"],[285,19,290,24],[285,21,290,33],[286,6,291,4],[286,10,291,8],[286,14,291,12],[286,15,291,13,"heartbeatTimer"],[286,29,291,27],[286,31,291,29],[287,8,292,6,"clearInterval"],[287,21,292,19],[287,22,292,20],[287,26,292,24],[287,27,292,25,"heartbeatTimer"],[287,41,292,39],[287,42,292,40],[288,8,293,6],[288,12,293,10],[288,13,293,11,"heartbeatTimer"],[288,27,293,25],[288,30,293,28],[288,34,293,32],[289,6,294,4],[290,4,295,2],[291,4,297,10,"_cleanup"],[291,12,297,18,"_cleanup"],[291,13,297,18],[291,15,297,27],[292,6,298,4],[292,10,298,8],[292,11,298,9,"_stopHeartbeat"],[292,25,298,23],[292,26,298,24],[292,27,298,25],[293,6,299,4],[293,10,299,8],[293,11,299,9,"_isConnected"],[293,23,299,21],[293,26,299,24],[293,31,299,29],[294,6,300,4],[294,10,300,8],[294,11,300,9,"_isAuthenticated"],[294,27,300,25],[294,30,300,28],[294,35,300,33],[295,6,301,4],[295,10,301,8],[295,11,301,9,"sessionId"],[295,20,301,18],[295,23,301,21],[295,27,301,25],[296,6,302,4],[296,10,302,8],[296,11,302,9,"ws"],[296,13,302,11],[296,16,302,14],[296,20,302,18],[297,4,303,2],[298,2,304,0],[300,2,306,0],[301,2,307,7],[301,8,307,13,"wsClient"],[301,16,307,21],[301,19,307,24],[301,23,307,28,"MyndLensWSClient"],[301,39,307,44],[301,40,307,45],[301,41,307,46],[302,0,307,47],[302,3]],"functionMap":{"names":["<global>","MyndLensWSClient","MyndLensWSClient#get__isConnected","MyndLensWSClient#get__isAuthenticated","MyndLensWSClient#get__currentSessionId","MyndLensWSClient#get__userId","MyndLensWSClient#on","<anonymous>","MyndLensWSClient#connect","Promise$argument_0","ws.onopen","ws.onmessage","ws.onclose","ws.onerror","MyndLensWSClient#send","MyndLensWSClient#sendExecuteRequest","MyndLensWSClient#disconnect","MyndLensWSClient#_routeMessage","_handleDsResolve._catch$argument_0","MyndLensWSClient#_dispatch","MyndLensWSClient#_handleDsResolve","nodeIds.filter$argument_0","nodeIds.filter.map$argument_0","MyndLensWSClient#_startHeartbeat","setInterval$argument_0","MyndLensWSClient#_stopHeartbeat","MyndLensWSClient#_cleanup"],"mappings":"AAA;OCgC;ECa,wDD;EEC,gEF;EGC,gEH;EIC,oDJ;EKK;WCK;KDI;GLC;EOK;uBCS;yBCc;SDU;4BEE;SFO;0BGE;SHe;0BIE;SJG;KDK;GPC;EaK;Gbc;EcK;GdM;EeK;GfK;EgBI;0DC6B;WDE;GhBW;EkBE;GlBS;EmBO;gBCU,mBD;aEC;UFG;GnBa;EsBE;sCCI;KDS;GtBG;EwBE;GxBK;EyBE;GzBM;CDC"},"hasCjsExports":false},"type":"js/module"}]}