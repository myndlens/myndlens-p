{"dependencies":[{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":14,"column":18,"index":440},"end":{"line":14,"column":47,"index":469}}],"key":"eWYjqsD9jBMtxXvXeA6eXvA4F1E=","exportNames":["*"],"imports":1,"isOptional":true}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.requestNotificationPermission = requestNotificationPermission;\n  exports.getNotificationPermissionStatus = getNotificationPermissionStatus;\n  exports.setupNotificationHandler = setupNotificationHandler;\n  exports.setupAndroidChannels = setupAndroidChannels;\n  exports.sendLocalNotification = sendLocalNotification;\n  exports.notifyMandateComplete = notifyMandateComplete;\n  exports.notifyMandateBlocked = notifyMandateBlocked;\n  var _reactNativeWebDistExportsPlatform = require(_dependencyMap[0], \"react-native-web/dist/exports/Platform\");\n  var Platform = _interopDefault(_reactNativeWebDistExportsPlatform);\n  /**\n   * Notification Manager — expo-notifications wrapper.\n   *\n   * Handles permission requests, channel setup, and local notification dispatch.\n   * Called from settings when the user enables 'Proactive' mode, and from the\n   * WS pipeline when a mandate completes.\n   */\n\n  // Dynamic require — graceful if expo-notifications not installed in dev build\n  let Notifications = null;\n  try {\n    Notifications = require(_dependencyMap[1], \"expo-notifications\");\n  } catch {\n    console.log('[Notifications] expo-notifications not available in this build');\n  }\n  /**\n   * Request notification permission from the OS.\n   * Returns the resulting status.\n   */\n  async function requestNotificationPermission() {\n    if (!Notifications) return 'undetermined';\n    try {\n      const {\n        status: existing\n      } = await Notifications.getPermissionsAsync();\n      if (existing === 'granted') return 'granted';\n      const {\n        status\n      } = await Notifications.requestPermissionsAsync({\n        ios: {\n          allowAlert: true,\n          allowBadge: true,\n          allowSound: true\n        }\n      });\n      return status;\n    } catch (err) {\n      console.log('[Notifications] Permission request failed:', err);\n      return 'undetermined';\n    }\n  }\n\n  /**\n   * Check current notification permission status without prompting.\n   */\n  async function getNotificationPermissionStatus() {\n    if (!Notifications) return 'undetermined';\n    try {\n      const {\n        status\n      } = await Notifications.getPermissionsAsync();\n      return status;\n    } catch {\n      return 'undetermined';\n    }\n  }\n\n  /**\n   * Configure notification handler — called once at app startup.\n   * Controls how notifications appear when the app is foregrounded.\n   */\n  function setupNotificationHandler() {\n    if (!Notifications) return;\n    Notifications.setNotificationHandler({\n      handleNotification: async () => ({\n        shouldShowAlert: true,\n        shouldPlaySound: false,\n        shouldSetBadge: false\n      })\n    });\n  }\n\n  /**\n   * Set up Android notification channel for mandate updates.\n   * No-op on iOS.\n   */\n  async function setupAndroidChannels() {\n    if (!Notifications || Platform.default.OS !== 'android') return;\n    try {\n      await Notifications.setNotificationChannelAsync('mandate_updates', {\n        name: 'Mandate Updates',\n        importance: Notifications.AndroidImportance.DEFAULT,\n        vibrationPattern: [0, 250, 250, 250],\n        lightColor: '#6C5CE7'\n      });\n      await Notifications.setNotificationChannelAsync('alerts', {\n        name: 'Alerts',\n        importance: Notifications.AndroidImportance.HIGH,\n        vibrationPattern: [0, 500],\n        lightColor: '#E74C3C'\n      });\n    } catch (err) {\n      console.log('[Notifications] Channel setup failed:', err);\n    }\n  }\n\n  /**\n   * Send a local notification immediately.\n   */\n  async function sendLocalNotification(title, body, channel = 'mandate_updates', data) {\n    if (!Notifications) return;\n    try {\n      const status = await getNotificationPermissionStatus();\n      if (status !== 'granted') return;\n      await Notifications.scheduleNotificationAsync({\n        content: {\n          title,\n          body,\n          data: data ?? {},\n          ...(Platform.default.OS === 'android' && {\n            channelId: channel\n          })\n        },\n        trigger: null // fire immediately\n      });\n    } catch (err) {\n      console.log('[Notifications] Send failed:', err);\n    }\n  }\n\n  /**\n   * Send a mandate completion notification.\n   * Called from the WS client when a pipeline_stage COMPLETED event arrives.\n   */\n  async function notifyMandateComplete(summary) {\n    await sendLocalNotification('Done', summary, 'mandate_updates');\n  }\n\n  /**\n   * Send a mandate blocked/error notification.\n   */\n  async function notifyMandateBlocked(reason) {\n    await sendLocalNotification('Action blocked', reason, 'alerts');\n  }\n});","lineCount":155,"map":[[12,2,25,0,"exports"],[12,9,25,0],[12,10,25,0,"requestNotificationPermission"],[12,39,25,0],[12,42,25,0,"requestNotificationPermission"],[12,71,25,0],[13,2,48,0,"exports"],[13,9,48,0],[13,10,48,0,"getNotificationPermissionStatus"],[13,41,48,0],[13,44,48,0,"getNotificationPermissionStatus"],[13,75,48,0],[14,2,62,0,"exports"],[14,9,62,0],[14,10,62,0,"setupNotificationHandler"],[14,34,62,0],[14,37,62,0,"setupNotificationHandler"],[14,61,62,0],[15,2,77,0,"exports"],[15,9,77,0],[15,10,77,0,"setupAndroidChannels"],[15,30,77,0],[15,33,77,0,"setupAndroidChannels"],[15,53,77,0],[16,2,100,0,"exports"],[16,9,100,0],[16,10,100,0,"sendLocalNotification"],[16,31,100,0],[16,34,100,0,"sendLocalNotification"],[16,55,100,0],[17,2,129,0,"exports"],[17,9,129,0],[17,10,129,0,"notifyMandateComplete"],[17,31,129,0],[17,34,129,0,"notifyMandateComplete"],[17,55,129,0],[18,2,136,0,"exports"],[18,9,136,0],[18,10,136,0,"notifyMandateBlocked"],[18,30,136,0],[18,33,136,0,"notifyMandateBlocked"],[18,53,136,0],[19,2,138,1],[19,6,138,1,"_reactNativeWebDistExportsPlatform"],[19,40,138,1],[19,43,138,1,"require"],[19,50,138,1],[19,51,138,1,"_dependencyMap"],[19,65,138,1],[20,2,138,1],[20,6,138,1,"Platform"],[20,14,138,1],[20,17,138,1,"_interopDefault"],[20,32,138,1],[20,33,138,1,"_reactNativeWebDistExportsPlatform"],[20,67,138,1],[21,2,1,0],[22,0,2,0],[23,0,3,0],[24,0,4,0],[25,0,5,0],[26,0,6,0],[27,0,7,0],[29,2,11,0],[30,2,12,0],[30,6,12,4,"Notifications"],[30,19,12,22],[30,22,12,25],[30,26,12,29],[31,2,13,0],[31,6,13,4],[32,4,14,2,"Notifications"],[32,17,14,15],[32,20,14,18,"require"],[32,27,14,25],[32,28,14,25,"_dependencyMap"],[32,42,14,25],[32,67,14,46],[32,68,14,47],[33,2,15,0],[33,3,15,1],[33,4,15,2],[33,10,15,8],[34,4,16,2,"console"],[34,11,16,9],[34,12,16,10,"log"],[34,15,16,13],[34,16,16,14],[34,80,16,78],[34,81,16,79],[35,2,17,0],[36,2,21,0],[37,0,22,0],[38,0,23,0],[39,0,24,0],[40,2,25,7],[40,17,25,22,"requestNotificationPermission"],[40,46,25,51,"requestNotificationPermission"],[40,47,25,51],[40,49,25,93],[41,4,26,2],[41,8,26,6],[41,9,26,7,"Notifications"],[41,22,26,20],[41,24,26,22],[41,31,26,29],[41,45,26,43],[42,4,27,2],[42,8,27,6],[43,6,28,4],[43,12,28,10],[44,8,28,12,"status"],[44,14,28,18],[44,16,28,20,"existing"],[45,6,28,29],[45,7,28,30],[45,10,28,33],[45,16,28,39,"Notifications"],[45,29,28,52],[45,30,28,53,"getPermissionsAsync"],[45,49,28,72],[45,50,28,73],[45,51,28,74],[46,6,29,4],[46,10,29,8,"existing"],[46,18,29,16],[46,23,29,21],[46,32,29,30],[46,34,29,32],[46,41,29,39],[46,50,29,48],[47,6,31,4],[47,12,31,10],[48,8,31,12,"status"],[49,6,31,19],[49,7,31,20],[49,10,31,23],[49,16,31,29,"Notifications"],[49,29,31,42],[49,30,31,43,"requestPermissionsAsync"],[49,53,31,66],[49,54,31,67],[50,8,32,6,"ios"],[50,11,32,9],[50,13,32,11],[51,10,33,8,"allowAlert"],[51,20,33,18],[51,22,33,20],[51,26,33,24],[52,10,34,8,"allowBadge"],[52,20,34,18],[52,22,34,20],[52,26,34,24],[53,10,35,8,"allowSound"],[53,20,35,18],[53,22,35,20],[54,8,36,6],[55,6,37,4],[55,7,37,5],[55,8,37,6],[56,6,38,4],[56,13,38,11,"status"],[56,19,38,17],[57,4,39,2],[57,5,39,3],[57,6,39,4],[57,13,39,11,"err"],[57,16,39,14],[57,18,39,16],[58,6,40,4,"console"],[58,13,40,11],[58,14,40,12,"log"],[58,17,40,15],[58,18,40,16],[58,62,40,60],[58,64,40,62,"err"],[58,67,40,65],[58,68,40,66],[59,6,41,4],[59,13,41,11],[59,27,41,25],[60,4,42,2],[61,2,43,0],[63,2,45,0],[64,0,46,0],[65,0,47,0],[66,2,48,7],[66,17,48,22,"getNotificationPermissionStatus"],[66,48,48,53,"getNotificationPermissionStatus"],[66,49,48,53],[66,51,48,95],[67,4,49,2],[67,8,49,6],[67,9,49,7,"Notifications"],[67,22,49,20],[67,24,49,22],[67,31,49,29],[67,45,49,43],[68,4,50,2],[68,8,50,6],[69,6,51,4],[69,12,51,10],[70,8,51,12,"status"],[71,6,51,19],[71,7,51,20],[71,10,51,23],[71,16,51,29,"Notifications"],[71,29,51,42],[71,30,51,43,"getPermissionsAsync"],[71,49,51,62],[71,50,51,63],[71,51,51,64],[72,6,52,4],[72,13,52,11,"status"],[72,19,52,17],[73,4,53,2],[73,5,53,3],[73,6,53,4],[73,12,53,10],[74,6,54,4],[74,13,54,11],[74,27,54,25],[75,4,55,2],[76,2,56,0],[78,2,58,0],[79,0,59,0],[80,0,60,0],[81,0,61,0],[82,2,62,7],[82,11,62,16,"setupNotificationHandler"],[82,35,62,40,"setupNotificationHandler"],[82,36,62,40],[82,38,62,49],[83,4,63,2],[83,8,63,6],[83,9,63,7,"Notifications"],[83,22,63,20],[83,24,63,22],[84,4,64,2,"Notifications"],[84,17,64,15],[84,18,64,16,"setNotificationHandler"],[84,40,64,38],[84,41,64,39],[85,6,65,4,"handleNotification"],[85,24,65,22],[85,26,65,24],[85,32,65,24,"handleNotification"],[85,33,65,24],[85,39,65,37],[86,8,66,6,"shouldShowAlert"],[86,23,66,21],[86,25,66,23],[86,29,66,27],[87,8,67,6,"shouldPlaySound"],[87,23,67,21],[87,25,67,23],[87,30,67,28],[88,8,68,6,"shouldSetBadge"],[88,22,68,20],[88,24,68,22],[89,6,69,4],[89,7,69,5],[90,4,70,2],[90,5,70,3],[90,6,70,4],[91,2,71,0],[93,2,73,0],[94,0,74,0],[95,0,75,0],[96,0,76,0],[97,2,77,7],[97,17,77,22,"setupAndroidChannels"],[97,37,77,42,"setupAndroidChannels"],[97,38,77,42],[97,40,77,60],[98,4,78,2],[98,8,78,6],[98,9,78,7,"Notifications"],[98,22,78,20],[98,26,78,24,"Platform"],[98,34,78,32],[98,35,78,32,"default"],[98,42,78,32],[98,43,78,33,"OS"],[98,45,78,35],[98,50,78,40],[98,59,78,49],[98,61,78,51],[99,4,79,2],[99,8,79,6],[100,6,80,4],[100,12,80,10,"Notifications"],[100,25,80,23],[100,26,80,24,"setNotificationChannelAsync"],[100,53,80,51],[100,54,80,52],[100,71,80,69],[100,73,80,71],[101,8,81,6,"name"],[101,12,81,10],[101,14,81,12],[101,31,81,29],[102,8,82,6,"importance"],[102,18,82,16],[102,20,82,18,"Notifications"],[102,33,82,31],[102,34,82,32,"AndroidImportance"],[102,51,82,49],[102,52,82,50,"DEFAULT"],[102,59,82,57],[103,8,83,6,"vibrationPattern"],[103,24,83,22],[103,26,83,24],[103,27,83,25],[103,28,83,26],[103,30,83,28],[103,33,83,31],[103,35,83,33],[103,38,83,36],[103,40,83,38],[103,43,83,41],[103,44,83,42],[104,8,84,6,"lightColor"],[104,18,84,16],[104,20,84,18],[105,6,85,4],[105,7,85,5],[105,8,85,6],[106,6,86,4],[106,12,86,10,"Notifications"],[106,25,86,23],[106,26,86,24,"setNotificationChannelAsync"],[106,53,86,51],[106,54,86,52],[106,62,86,60],[106,64,86,62],[107,8,87,6,"name"],[107,12,87,10],[107,14,87,12],[107,22,87,20],[108,8,88,6,"importance"],[108,18,88,16],[108,20,88,18,"Notifications"],[108,33,88,31],[108,34,88,32,"AndroidImportance"],[108,51,88,49],[108,52,88,50,"HIGH"],[108,56,88,54],[109,8,89,6,"vibrationPattern"],[109,24,89,22],[109,26,89,24],[109,27,89,25],[109,28,89,26],[109,30,89,28],[109,33,89,31],[109,34,89,32],[110,8,90,6,"lightColor"],[110,18,90,16],[110,20,90,18],[111,6,91,4],[111,7,91,5],[111,8,91,6],[112,4,92,2],[112,5,92,3],[112,6,92,4],[112,13,92,11,"err"],[112,16,92,14],[112,18,92,16],[113,6,93,4,"console"],[113,13,93,11],[113,14,93,12,"log"],[113,17,93,15],[113,18,93,16],[113,57,93,55],[113,59,93,57,"err"],[113,62,93,60],[113,63,93,61],[114,4,94,2],[115,2,95,0],[117,2,97,0],[118,0,98,0],[119,0,99,0],[120,2,100,7],[120,17,100,22,"sendLocalNotification"],[120,38,100,43,"sendLocalNotification"],[120,39,101,2,"title"],[120,44,101,15],[120,46,102,2,"body"],[120,50,102,14],[120,52,103,2,"channel"],[120,59,103,39],[120,62,103,42],[120,79,103,59],[120,81,104,2,"data"],[120,85,104,32],[120,87,105,17],[121,4,106,2],[121,8,106,6],[121,9,106,7,"Notifications"],[121,22,106,20],[121,24,106,22],[122,4,107,2],[122,8,107,6],[123,6,108,4],[123,12,108,10,"status"],[123,18,108,16],[123,21,108,19],[123,27,108,25,"getNotificationPermissionStatus"],[123,58,108,56],[123,59,108,57],[123,60,108,58],[124,6,109,4],[124,10,109,8,"status"],[124,16,109,14],[124,21,109,19],[124,30,109,28],[124,32,109,30],[125,6,111,4],[125,12,111,10,"Notifications"],[125,25,111,23],[125,26,111,24,"scheduleNotificationAsync"],[125,51,111,49],[125,52,111,50],[126,8,112,6,"content"],[126,15,112,13],[126,17,112,15],[127,10,113,8,"title"],[127,15,113,13],[128,10,114,8,"body"],[128,14,114,12],[129,10,115,8,"data"],[129,14,115,12],[129,16,115,14,"data"],[129,20,115,18],[129,24,115,22],[129,25,115,23],[129,26,115,24],[130,10,116,8],[130,14,116,12,"Platform"],[130,22,116,20],[130,23,116,20,"default"],[130,30,116,20],[130,31,116,21,"OS"],[130,33,116,23],[130,38,116,28],[130,47,116,37],[130,51,116,41],[131,12,116,43,"channelId"],[131,21,116,52],[131,23,116,54,"channel"],[132,10,116,62],[132,11,116,63],[133,8,117,6],[133,9,117,7],[134,8,118,6,"trigger"],[134,15,118,13],[134,17,118,15],[134,21,118,19],[134,22,118,21],[135,6,119,4],[135,7,119,5],[135,8,119,6],[136,4,120,2],[136,5,120,3],[136,6,120,4],[136,13,120,11,"err"],[136,16,120,14],[136,18,120,16],[137,6,121,4,"console"],[137,13,121,11],[137,14,121,12,"log"],[137,17,121,15],[137,18,121,16],[137,48,121,46],[137,50,121,48,"err"],[137,53,121,51],[137,54,121,52],[138,4,122,2],[139,2,123,0],[141,2,125,0],[142,0,126,0],[143,0,127,0],[144,0,128,0],[145,2,129,7],[145,17,129,22,"notifyMandateComplete"],[145,38,129,43,"notifyMandateComplete"],[145,39,129,44,"summary"],[145,46,129,59],[145,48,129,76],[146,4,130,2],[146,10,130,8,"sendLocalNotification"],[146,31,130,29],[146,32,130,30],[146,38,130,36],[146,40,130,38,"summary"],[146,47,130,45],[146,49,130,47],[146,66,130,64],[146,67,130,65],[147,2,131,0],[149,2,133,0],[150,0,134,0],[151,0,135,0],[152,2,136,7],[152,17,136,22,"notifyMandateBlocked"],[152,37,136,42,"notifyMandateBlocked"],[152,38,136,43,"reason"],[152,44,136,57],[152,46,136,74],[153,4,137,2],[153,10,137,8,"sendLocalNotification"],[153,31,137,29],[153,32,137,30],[153,48,137,46],[153,50,137,48,"reason"],[153,56,137,54],[153,58,137,56],[153,66,137,64],[153,67,137,65],[154,2,138,0],[155,0,138,1],[155,3]],"functionMap":{"names":["<global>","requestNotificationPermission","getNotificationPermissionStatus","setupNotificationHandler","Notifications.setNotificationHandler$argument_0.handleNotification","setupAndroidChannels","sendLocalNotification","notifyMandateComplete","notifyMandateBlocked"],"mappings":"AAA;OCwB;CDkB;OEK;CFQ;OGM;wBCG;MDI;CHE;OKM;CLkB;OMK;CNuB;OOM;CPE;OQK;CRE"},"hasCjsExports":false},"type":"js/module"}]}